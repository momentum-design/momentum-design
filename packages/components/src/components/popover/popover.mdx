{/* popover.accessibility.stories.mdx */}
import { Meta, Title, Primary, Controls } from '@storybook/blocks';

import * as PopoverStories from './popover.stories';

<Meta of={PopoverStories} name="User Stories" />

<Title>User Stories</Title>

### ✅ Default Behavior

**Scenario: Toggle popover on trigger element click (mouse)**  
> Given a trigger element such as a button,  
> When the user clicks on the button,  
> Then the popover should become visible if it was hidden,  
> And the popover should become hidden if it was already visible.

**Scenario: Toggle popover on trigger element activation (keyboard)**  
> Given a trigger element is focused,  
> When the user presses the **Space** or **Enter** key,  
> Then the popover should become visible if it was hidden,  
> And the popover should become hidden if it was already visible.

**Scenario: Initial visibility**  
> Given a popover component, which is hidden by default,  
> When the `visible` attribute is set to `true`,    
> Then the popover should be visible (if closed).   
> When the `visible` attribute is set to `false,    
> Then the popover should be hidden (if opened).

---

### ✅ Attributes

**Scenario: Role attribute**  
> Given a popover component,  
> Then its default role should be set to `dialog`,  
> And the role can be customized using the `role` attribute.

**Scenario: Placement attribute**  
> Given a popover component,  
> Then it should be placed below the trigger element by default,  
> And the placement can be modified using the `placement` attribute to top, left, right, bottom, etc.

**Scenario: Flip attribute**
> Given a popover component which is visible,   
> When the `flip` attribute is set to `true`,   
> Then the floating popover should change the placement based on the availability of viewport.

**Scenario: Display arrow**  
> Given a popover component,  
> When the `show-arrow` attribute is set to `true`,  
> Then an arrow should be displayed connecting the popover visually to its trigger.     
> When the `show-arrow` attribute is set to `false`,  
> Then no arrow should be displayed connecting the popover visually to its trigger.

**Scenario: Hide on outside click**  
> Given a popover component,  
> When the `hide-on-outside-click` attribute is set to `true`,  
> And the user clicks outside of the popover,  
> Then the popover should close.

**Scenario: Backdrop attribute with hide on outside click**
> Given a popover component with `backdrop` and `hide-on-outside-click` attributes set to `true`.   
> When the user clicks outside of the popover once.     
> Then the user can interact with rest of the contents.     
> When the user clicks outside of the popover again (for second time).      
> Then the popover should close.

**Scenario: Hide on blur (focus out)**  
> Given the `hide-on-blur` attribute is set to `true`,  
> When the user shifts focus away from the popover,     
> Then the popover should close.    

**Scenario: Hide on escape (keyboard)**  
> Given the `hide-on-escape` attribute is set to `true`,  
> When the user press **Escape** key on the popover,  
> Then the popover should close.

**Scenario: Focus back to trigger element**
> Given the `focus-back-to-trigger` attribute is set to `true`.     
> When the open popover gets closed,    
> Then the trigger element should be focused.

**Scenario: Focus trap inside popover**  
> Given the popover contains interactive content,  
> When the `focus-trap` attribute is set to `true`,  
> Then the user should not be able to move focus outside of the popover until it is closed.

**Scenario: Prevent outside scroll**  
> Given the `prevent-scroll` attribute is set,  
> When the popover is open,  
> Then scrolling the background page should be disabled.

**Scenario: Close button inside popover**  
> Given the `close-button` attribute is set,  
> Then an "X" icon button should appear inside the popover on top right corner.  
> When the user clicks the close button,  
> Then the popover should close.  
> And the close button can have an accessible label via `close-button-aria-label`.

---

### ✅ Accessibility

**Scenario: Default accessibility attributes**  
> Given a popover component,  
> Then it should have a default role of `dialog`.  
> And it can support `aria-label`, `aria-labelledby`, and `aria-describedby`.  
> When the popover has `interactive` attribute set to `true`,  
> Then the trigger should have `aria-haspopup` set to `dialog` (by default),  
> And the user can override `aria-haspopup` if needed.  
> When the popover is open,  
> Then the trigger should have `aria-expanded="true"`.  
> When the popover is closed,  
> Then the trigger should have `aria-expanded="false"`.  
> Then the `disable-aria-expanded` attribute should be used to remove `aria-expanded`.  
> When the popover has interactive attribute set to `true`  
> And has a role of `dialog` or `alertdialog`,  
> Then the `aria-modal` attribute should be set to `true`.

---

### ✅ Styling

**Scenario: Color attribute**
> Give a popover component,     
> Then its default `color` should be set to `tonal`,  
> And the `color` can be updated to `contrast` with the `color` attribute.

**Scenario: Offset attribute**
> Give a popover component,     
> Then the distance between the trigger element and floating element should be set to `4` by default,   
> And the `offset` attribute can be used to adjust the distance.

**Scenario: Size attribute**
> Give a popover component,     
> Then it's default size is set to `false`.     
> And the `size` attribute can be set to `true` to change the popover size to keep it in view when scrolling.

**Scenario: zIndex attribute**
> Give a popover component,     
> Then it's default z-index is set to `1000`.   
> And the `z-index` attribute can be set to any number to update the z-order of a positioned popover.

### ✅ Nested Popovers

**Scenario: Close only child popover on outside click**  
> Given a parent popover and a nested child popover are both open,  
> And both have the `hide-on-outside-click` attribute set,  
> When the user clicks outside the child popover,  
> Then only the child popover should close,  
> And the parent popover should remain open.  
> When the user clicks outside again,  
> Then the parent popover should close.

---
