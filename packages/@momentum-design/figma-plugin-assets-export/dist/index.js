"use strict";(()=>{var p=(a,t,e)=>new Promise((s,i)=>{var T=o=>{try{r(e.next(o))}catch(m){i(m)}},g=o=>{try{r(e.throw(o))}catch(m){i(m)}},r=o=>o.done?s(o.value):Promise.resolve(o.value).then(T,g);r((e=e.apply(a,t)).next())});var c={GET_SETTINGS:"storage_get_settings",SET_SETTINGS:"storage_set_settings",EXPORT:"export",PR_CREATED:"pr_created"};var L={VALID_CHILD_TYPES:["PAGE"]},x=["COMPONENT"],w={COMPONENT_NAME:"COMPONENT_NAME",PARENT_NAME:"PARENT_NAME",SET_OR_COMPONENT_NAME:"SET_OR_COMPONENT_NAME",SF_ALTERNATIVE:"SF_ALTERNATIVE",RTL:"RTL",WEIGHT:"WEIGHT",COLOR:"COLOR",STATE:"STATE",SIZE:"SIZE"},G={WEIGHT:"weight",COLOR:"color",RTL:"right to left",SF_ALTERNATIVE:"sf alternative",STATE:"state",SIZE:"size"},n={DOCUMENT:L,SEARCH_CRITERIA:x,REPLACE_TERMS:w,FIGMA_VARIANTS:G};var S=a=>a?Object.keys(a).reduce((t,e)=>{let s=e.toLowerCase(),i=a[e].toLowerCase();return t[s]=i,t},{}):{};var l=class{constructor(t,e,s){this.node=t,this.destination=e,this.assetSetting=s,this.variants=S(this.node.variantProperties)}get replacementMap(){var g,r,o,m,f,h,N,R,C;let t=((g=this.node.parent)==null?void 0:g.type)==="COMPONENT_SET"?this.node.parent.name:this.node.name,e=((r=this.variants)==null?void 0:r[n.FIGMA_VARIANTS.RTL])==="true"?"rtl":void 0,s=((o=this.variants)==null?void 0:o[n.FIGMA_VARIANTS.SF_ALTERNATIVE])==="true"?"sf":void 0,i=((m=this.variants)==null?void 0:m[n.FIGMA_VARIANTS.SIZE])==="default"||(f=this.variants)==null?void 0:f[n.FIGMA_VARIANTS.SIZE];return{[n.REPLACE_TERMS.COMPONENT_NAME]:this.node.name,[n.REPLACE_TERMS.PARENT_NAME]:(h=this.node.parent)==null?void 0:h.name,[n.REPLACE_TERMS.SET_OR_COMPONENT_NAME]:t,[n.REPLACE_TERMS.WEIGHT]:(N=this.variants)==null?void 0:N[n.FIGMA_VARIANTS.WEIGHT],[n.REPLACE_TERMS.STATE]:(R=this==null?void 0:this.variants)==null?void 0:R[n.FIGMA_VARIANTS.STATE],[n.REPLACE_TERMS.COLOR]:(C=this.variants)==null?void 0:C[n.FIGMA_VARIANTS.COLOR],[n.REPLACE_TERMS.SIZE]:i,[n.REPLACE_TERMS.RTL]:e,[n.REPLACE_TERMS.SF_ALTERNATIVE]:s}}get assetName(){let t="",{fileName:e,exportSettings:s}=this.assetSetting.input.asset,i=e.parts.reduce((g,r)=>{let o=this.replacementMap[r];return o&&g.push(o),g},[]);return t+=i.join(e.separator),e.suffix.parts.forEach(g=>{var o;let r=(o=this.replacementMap)==null?void 0:o[g];r&&(t+=e.suffix.separator,t+=r)}),t.endsWith("-black")&&(t=t.replace("-black","")),t+=".",t+=s.format,t.toLowerCase()}get asset(){return new Promise((t,e)=>{this.node.exportAsync(this.assetSetting.input.asset.exportSettings).then(s=>{t({path:`${this.destination?`${this.destination}/`:""}${this.assetName}`,data:String.fromCharCode.apply(null,s)})}).catch(s=>{figma.notify(s,{error:!0}),e(s)})})}},I=l;var A=class{constructor(t,e,s){this.node=t,this.destination=e,this.assetSetting=s}get assets(){return Promise.all(this.components.map(t=>t.asset))}excludeComponents(t){let{exclude:e}=this.assetSetting.input;return e?t.filter(s=>{var i;return((i=S(s.variantProperties))==null?void 0:i[e.byVariant])!=="true"}):t}get components(){let t=this.node.findAllWithCriteria({types:n.SEARCH_CRITERIA});return this.excludeComponents(t).map(s=>new I(s,this.destination,this.assetSetting))}},_=A;var E=class{constructor(t,e){this.node=t,this.assetSetting=e}getDestination(t,e){let s=e.find(i=>t.toLowerCase().includes(i.page.toLowerCase()));return s==null?void 0:s.folder}get pages(){let t=[];if("children"in this.node){for(let e of this.node.children)if(n.DOCUMENT.VALID_CHILD_TYPES.includes(e.type)){let s=this.getDestination(e.name,this.assetSetting.input.mapPagesToFolder);(s||s==="")&&t.push(new _(e,s,this.assetSetting))}}return t}createChunks(t){let s=[];for(let i=0;i<t.length;i+=500)s.push(t.slice(i,i+500));return s}getAssetChunksFromPages(){return p(this,null,function*(){if(!this.pages.length)return[[]];let t=[];return yield Promise.all(this.pages.map(e=>e.assets.then(s=>{t.push(...s)}))),this.createChunks(t)})}},O=E;var F={auth:{githubPersonalToken:"<YourClassicPersonalAccessTokenHere>"},assets:{icons:{name:"Icons",description:{name:"Icons",url:"https://github.com/momentum-design/momentum-design/tree/main/packages/%40momentum-design/icons",urlText:"Momentum icons package"},input:{mapPagesToFolder:[{page:"\u2705",folder:"core"},{page:"Colored Icons",folder:"colored"},{page:"Brand Icons",folder:"brand"}],exclude:{byVariant:"sf alternative"},asset:{fileName:{parts:["SET_OR_COMPONENT_NAME","SF_ALTERNATIVE","RTL"],separator:"-",suffix:{parts:["WEIGHT","STATE","SIZE"],separator:"_"}},exportSettings:{format:"SVG",contentsOnly:!0,useAbsoluteBounds:!1}}},output:{git:{githubOwner:"momentum-design",gitRepo:"momentum-design",gitBranch:`automation-icons-${new Date().toISOString().replace(/\.|:/g,"-")}`,prTitle:`Automated Icons Export ${new Date().toISOString()}`,prCommitMsg:`feat(assets/icons): Export ${new Date().toISOString()}`,prMessage:`feat(assets/icons): Export ${new Date().toISOString()}`,gitRepoFilePath:"packages/@momentum-design/icons",gitDistPath:"src"}}},illustrations:{name:"Illustrations",description:{name:"Illustrations",url:"https://github.com/momentum-design/momentum-design/tree/main/packages/%40momentum-design/illustrations",urlText:"Momentum illustrations package"},input:{mapPagesToFolder:[{page:"\u2705",folder:""}],exclude:{byVariant:"sf alternative"},asset:{fileName:{parts:["SET_OR_COMPONENT_NAME","SF_ALTERNATIVE","RTL"],separator:"-",suffix:{parts:["COLOR"],separator:"-"}},exportSettings:{format:"SVG",contentsOnly:!0,useAbsoluteBounds:!1}}},output:{git:{githubOwner:"momentum-design",gitRepo:"momentum-design",gitBranch:`automation-illustrations-${new Date().toISOString().replace(/\.|:/g,"-")}`,prTitle:`Automated Illustrations Export ${new Date().toISOString()}`,prCommitMsg:`feat(assets/illustrations): Export ${new Date().toISOString()}`,prMessage:`feat(assets/illustrations): Export ${new Date().toISOString()}`,gitRepoFilePath:"packages/@momentum-design/illustrations",gitDistPath:"src"}}}}},P={INITIAL_SETTINGS:F};var M="settings",d=class{constructor(){this.initialSettings=P.INITIAL_SETTINGS;this.api=figma.clientStorage}setSettings(t){return p(this,null,function*(){return this.api.setAsync(M,t)})}getSettings(){return p(this,null,function*(){return this.api.getAsync(M)})}},y=d;var u=new y;figma.on("run",()=>p(void 0,null,function*(){(yield u.getSettings())||(yield u.setSettings(u.initialSettings))}));figma.skipInvisibleInstanceChildren=!0;figma.showUI(__html__,{themeColors:!0,height:550,width:450});figma.ui.onmessage=a=>p(void 0,null,function*(){var t,e;if(a.type===c.EXPORT){let i=yield new O(figma.root,a.assetSetting).getAssetChunksFromPages();figma.ui.postMessage({type:"assets",data:i},{origin:"*"}),figma.ui.postMessage({type:"export"},{origin:"*"})}if(a.type===c.SET_SETTINGS&&(figma.ui.postMessage({type:"storage",data:"inprogress"},{origin:"*"}),yield u.setSettings(a.settings),figma.ui.postMessage({type:"storage",data:"complete"},{origin:"*"})),a.type===c.GET_SETTINGS){let s=yield u.getSettings();figma.ui.postMessage({type:"settings",data:s},{origin:"*"})}a.type===c.PR_CREATED&&figma.notify(`Pull Request: ${(e=(t=a.pullRequest)==null?void 0:t.data)==null?void 0:e.url}`)});})();
