"use strict";(()=>{var p=(i,t,e)=>new Promise((s,n)=>{var c=o=>{try{r(e.next(o))}catch(m){n(m)}},g=o=>{try{r(e.throw(o))}catch(m){n(m)}},r=o=>o.done?s(o.value):Promise.resolve(o.value).then(c,g);r((e=e.apply(i,t)).next())});var u={GET_SETTINGS:"storage_get_settings",SET_SETTINGS:"storage_set_settings",EXPORT:"export",PR_CREATED:"pr_created"};var I={VALID_CHILD_TYPES:["PAGE"]},P=["COMPONENT"],y={COMPONENT_NAME:"COMPONENT_NAME",PARENT_NAME:"PARENT_NAME",SET_OR_COMPONENT_NAME:"SET_OR_COMPONENT_NAME",SF_ALTERNATIVE:"SF_ALTERNATIVE",RTL:"RTL",WEIGHT:"WEIGHT",COLOR:"COLOR"},M={WEIGHT:"weight",COLOR:"color",RTL:"right to left",SF_ALTERNATIVE:"sf alternative"},a={DOCUMENT:I,SEARCH_CRITERIA:P,REPLACE_TERMS:y,FIGMA_VARIANTS:M};var S=i=>i?Object.keys(i).reduce((t,e)=>{let s=e.toLowerCase(),n=i[e].toLowerCase();return t[s]=n,t},{}):{};var T=class{constructor(t,e,s){this.node=t,this.destination=e,this.assetSetting=s,this.variants=S(this.node.variantProperties)}get replacementMap(){var c,g,r,o,m,f;let t=((c=this.node.parent)==null?void 0:c.type)==="COMPONENT_SET"?this.node.parent.name:this.node.name,e=((g=this.variants)==null?void 0:g[a.FIGMA_VARIANTS.RTL])==="true"?"rtl":void 0,s=((r=this.variants)==null?void 0:r[a.FIGMA_VARIANTS.SF_ALTERNATIVE])==="true"?"sf":void 0;return{[a.REPLACE_TERMS.COMPONENT_NAME]:this.node.name,[a.REPLACE_TERMS.PARENT_NAME]:(o=this.node.parent)==null?void 0:o.name,[a.REPLACE_TERMS.SET_OR_COMPONENT_NAME]:t,[a.REPLACE_TERMS.WEIGHT]:(m=this.variants)==null?void 0:m[a.FIGMA_VARIANTS.WEIGHT],[a.REPLACE_TERMS.COLOR]:(f=this.variants)==null?void 0:f[a.FIGMA_VARIANTS.COLOR],[a.REPLACE_TERMS.RTL]:e,[a.REPLACE_TERMS.SF_ALTERNATIVE]:s}}get assetName(){let t="",{fileName:e,exportSettings:s}=this.assetSetting.input.asset,n=e.parts.reduce((g,r)=>{let o=this.replacementMap[r];return o&&g.push(o),g},[]);return t+=n.join(e.separator),e.suffix.parts.forEach(g=>{var o;let r=(o=this.replacementMap)==null?void 0:o[g];r&&(t+=e.suffix.separator,t+=r)}),t.endsWith("-black")&&(t=t.replace("-black","")),t+=".",t+=s.format.toLowerCase(),t}get asset(){return new Promise((t,e)=>{this.node.exportAsync(this.assetSetting.input.asset.exportSettings).then(s=>{t({path:`${this.destination?`${this.destination}/`:""}${this.assetName}`,data:String.fromCharCode.apply(null,s)})}).catch(s=>{figma.notify(s,{error:!0}),e(s)})})}},h=T;var d=class{constructor(t,e,s){this.node=t,this.destination=e,this.assetSetting=s}get assets(){return Promise.all(this.components.map(t=>t.asset))}excludeComponents(t){let{exclude:e}=this.assetSetting.input;return e?t.filter(s=>{var n;return((n=S(s.variantProperties))==null?void 0:n[e.byVariant])!=="true"}):t}get components(){let t=this.node.findAllWithCriteria({types:a.SEARCH_CRITERIA});return this.excludeComponents(t).map(s=>new h(s,this.destination,this.assetSetting))}},N=d;var A=class{constructor(t,e){this.node=t,this.assetSetting=e}getDestination(t,e){let s=e.find(n=>t.toLowerCase().includes(n.page.toLowerCase()));return s==null?void 0:s.folder}get pages(){let t=[];if("children"in this.node){for(let e of this.node.children)if(a.DOCUMENT.VALID_CHILD_TYPES.includes(e.type)){let s=this.getDestination(e.name,this.assetSetting.input.mapPagesToFolder);(s||s==="")&&t.push(new N(e,s,this.assetSetting))}}return t}createChunks(t){let s=[];for(let n=0;n<t.length;n+=500)s.push(t.slice(n,n+500));return s}getAssetChunksFromPages(){return p(this,null,function*(){if(!this.pages.length)return[[]];let t=[];return yield Promise.all(this.pages.map(e=>e.assets.then(s=>{t.push(...s)}))),this.createChunks(t)})}},C=A;var L={auth:{githubPersonalToken:"<YourClassicPersonalAccessTokenHere>"},assets:{icons:{name:"Icons",description:{name:"Icons",url:"https://github.com/momentum-design/momentum-design/tree/main/packages/%40momentum-design/icons",urlText:"Momentum icons package"},input:{mapPagesToFolder:[{page:"\u2705",folder:"core"},{page:"Colored Icons",folder:"colored"},{page:"Brand Icons",folder:"brand"}],exclude:{byVariant:"sf alternative"},asset:{fileName:{parts:["SET_OR_COMPONENT_NAME","SF_ALTERNATIVE","RTL"],separator:"-",suffix:{parts:["WEIGHT"],separator:"_"}},exportSettings:{format:"SVG",contentsOnly:!0,useAbsoluteBounds:!1}}},output:{git:{githubOwner:"momentum-design",gitRepo:"momentum-design",gitBranch:`automation-icons-${new Date().toISOString().replace(/\.|:/g,"-")}`,prTitle:`Automated Icons Export ${new Date().toISOString()}`,prCommitMsg:`feat(assets/icons): Export ${new Date().toISOString()}`,prMessage:`feat(assets/icons): Export ${new Date().toISOString()}`,gitRepoFilePath:"packages/@momentum-design/icons",gitDistPath:"src"}}},illustrations:{name:"Illustrations",description:{name:"Illustrations",url:"https://github.com/momentum-design/momentum-design/tree/main/packages/%40momentum-design/illustrations",urlText:"Momentum illustrations package"},input:{mapPagesToFolder:[{page:"\u2705",folder:""}],exclude:{byVariant:"sf alternative"},asset:{fileName:{parts:["SET_OR_COMPONENT_NAME","SF_ALTERNATIVE","RTL"],separator:"-",suffix:{parts:["COLOR"],separator:"-"}},exportSettings:{format:"SVG",contentsOnly:!0,useAbsoluteBounds:!1}}},output:{git:{githubOwner:"momentum-design",gitRepo:"momentum-design",gitBranch:`automation-illustrations-${new Date().toISOString().replace(/\.|:/g,"-")}`,prTitle:`Automated Illustrations Export ${new Date().toISOString()}`,prCommitMsg:`feat(assets/illustrations): Export ${new Date().toISOString()}`,prMessage:`feat(assets/illustrations): Export ${new Date().toISOString()}`,gitRepoFilePath:"packages/@momentum-design/illustrations",gitDistPath:"src"}}}}},R={INITIAL_SETTINGS:L};var O="settings",E=class{constructor(){this.initialSettings=R.INITIAL_SETTINGS;this.api=figma.clientStorage}setSettings(t){return p(this,null,function*(){return this.api.setAsync(O,t)})}getSettings(){return p(this,null,function*(){return this.api.getAsync(O)})}},_=E;var l=new _;figma.on("run",()=>p(void 0,null,function*(){(yield l.getSettings())||(yield l.setSettings(l.initialSettings))}));figma.skipInvisibleInstanceChildren=!0;figma.showUI(__html__,{themeColors:!0,height:430,width:430});figma.ui.onmessage=i=>p(void 0,null,function*(){var t,e;if(i.type===u.EXPORT){let n=yield new C(figma.root,i.assetSetting).getAssetChunksFromPages();figma.ui.postMessage({type:"assets",data:n},{origin:"*"}),figma.ui.postMessage({type:"export"},{origin:"*"})}if(i.type===u.SET_SETTINGS&&(figma.ui.postMessage({type:"storage",data:"inprogress"},{origin:"*"}),yield l.setSettings(i.settings),figma.ui.postMessage({type:"storage",data:"complete"},{origin:"*"})),i.type===u.GET_SETTINGS){let s=yield l.getSettings();figma.ui.postMessage({type:"settings",data:s},{origin:"*"})}i.type===u.PR_CREATED&&figma.notify(`Pull Request: ${(e=(t=i.pullRequest)==null?void 0:t.data)==null?void 0:e.url}`)});})();
