import{n as T}from"./index-C9z9WAEj.js";import{K as r}from"./listitem.component-B4xe0EG5.js";import{R as h}from"./roles-BH_hBfTz.js";import{T as v,a as k}from"./menuitemradio.constants-BhdhQZcn.js";import{T as E}from"./menuitem.component-kfTMc_TM.js";import{T as C}from"./menuitemcheckbox.constants-DmrkQGAP.js";import{a as I,p as l,C as M}from"./popover.component-C7-8N8j7.js";import{T as d,D as A}from"./menupopover.constants-C2PqsYtb.js";import{i as y}from"./lit-element-D5KKan5q.js";const O=y`
  :host::part(popover-content) {
    padding: 0.75rem 0.5rem;
  }

  ::slotted(mdc-divider) {
    margin-block: 0.25rem;
  }
`,R=[O],c=n=>{var t;if(!n)return!1;const e=(t=n.getAttribute("role"))==null?void 0:t.toLowerCase();return e===h.MENUITEM||e===h.MENUITEMCHECKBOX||e===h.MENUITEMRADIO},P=n=>{var e;return((e=n==null?void 0:n.tagName)==null?void 0:e.toLowerCase())===d};var N=Object.defineProperty,L=(n,e,t,i)=>{for(var s=void 0,a=n.length-1,m;a>=0;a--)(m=n[a])&&(s=m(e,t,s)||s);return s&&N(e,t,s),s};const p=class p extends I{constructor(){super(),this.placement=A.PLACEMENT,this.menuItems=[],this.onOutsidePopoverClick=e=>{if(l.peek()!==this)return;const t=this.findClosestPopover(e.target);if(t&&l.has(t)){this.closeAllMenuPopovers(t);return}const i=e.composedPath(),s=this.contains(e.target)||i.includes(this.triggerElement),a=this.backdropElement?i.includes(this.backdropElement):!1;(!s||a)&&this.closeAllMenuPopovers()},this.togglePopoverVisible=()=>{var e;(e=this.triggerElement)!=null&&e.hasAttribute("soft-disabled")||(this.isTriggerClicked?this.hidePopover():(this.showPopover(),this.isTriggerClicked=!0))},this.handleItemChangeEvent=e=>{e.stopImmediatePropagation(),e.target&&e.type==="destroyed"&&(e.target.removeEventListener("destroyed",this.handleItemChangeEvent),e.target.removeEventListener("disabled",this.handleItemChangeEvent)),this.resetMenuNavigation()},this.resetMenuNavigation=()=>{this.collectMenuItems(),this.menuItems.find(t=>t.getAttribute("tabindex")==="0")||this.resetTabIndexes(0)},this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("keyup",this.handleKeyUp),this.addEventListener("click",this.handleMouseClick),this.addEventListener("created",this.handleItemCreation)}collectMenuItems(){var i;const e=(i=this.shadowRoot)==null?void 0:i.querySelector("slot"),t=(e==null?void 0:e.assignedElements({flatten:!0}))||[];this.menuItems=t.map(s=>s.tagName.toLowerCase()===v?Array.from(s.children).filter(a=>c(a)):c(s)?s:[]).flat().filter(s=>!!s&&!s.hasAttribute("disabled"))}connectedCallback(){super.connectedCallback(),this.role=h.MENU,this.ariaOrientation=A.ORIENTATION,this.backdrop=!1,this.color=M.TONAL,this.disableAriaExpanded=!1,this.focusBackToTrigger=!0,this.focusTrap=!0,this.hideOnEscape=!0,this.hideOnOutsideClick=!0,this.interactive=!0,this.showArrow=!1,this.closeButton=!1,this.closeButtonAriaLabel=null}async isOpenUpdated(e,t){return e===t||!this.triggerElement?Promise.resolve():(t&&(this.backdrop=this.triggerElement.tagName.toLowerCase()!==E),this.resetMenuNavigation(),super.isOpenUpdated(e,t))}async firstUpdated(e){var t;await super.firstUpdated(e),this.collectMenuItems(),this.resetTabIndexes(0),(t=this.triggerElement)==null||t.setAttribute("aria-haspopup",h.MENU)}resetTabIndexes(e){this.menuItems.length>0&&(this.menuItems.forEach(t=>t.setAttribute("tabindex","-1")),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}getCurrentIndex(e){return this.menuItems.findIndex(t=>t===e)}resetTabIndexAndSetFocus(e,t){e!==t&&(this.menuItems[t].setAttribute("tabindex","-1"),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}closeAllMenuPopovers(e){for(;l.peek()!==e;){const t=l.pop();if(t)t.hidePopover();else break}}hasSubmenuWithTriggerId(e){var t,i;return!!e&&((i=(t=this.parentElement)==null?void 0:t.querySelector)==null?void 0:i.call(t,`${d}[triggerid="${e}"]`))!==null}closeMenu(e){const t=e.getAttribute("id");c(e)&&!this.hasSubmenuWithTriggerId(t)&&this===e.closest(d)&&(this.closeAllMenuPopovers(),e.matches(E)&&e.dispatchEvent(new Event("action",{bubbles:!0,composed:!0})))}handleMouseClick(e){const t=e.target;e.isTrusted&&this.closeMenu(t)}handleItemCreation(e){const t=e.target;c(t)&&(e.stopImmediatePropagation(),t.addEventListener("destroyed",this.handleItemChangeEvent),t.addEventListener("disabled",this.handleItemChangeEvent))}resolveDirectionKey(e,t){if(!t)return e;switch(e){case r.ARROW_LEFT:return r.ARROW_RIGHT;case r.ARROW_RIGHT:return r.ARROW_LEFT;default:return e}}handleKeyDown(e){var g,f;let t=!1;this.collectMenuItems();const i=e.target,s=this.getCurrentIndex(i);if(s===-1)return;this.resetTabIndexes(s);const a=window.getComputedStyle(this).direction==="rtl";switch(this.resolveDirectionKey(e.key,a)){case r.HOME:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case r.END:{this.resetTabIndexAndSetFocus(this.menuItems.length-1,s),t=!0;break}case r.ARROW_DOWN:{const o=s+1===this.menuItems.length?0:s+1;this.resetTabIndexAndSetFocus(o,s),t=!0;break}case r.ARROW_UP:{const o=s-1===-1?this.menuItems.length-1:s-1;this.resetTabIndexAndSetFocus(o,s),t=!0;break}case r.ARROW_RIGHT:{const o=(g=this.menuItems[s])==null?void 0:g.getAttribute("id");if(this.hasSubmenuWithTriggerId(o)){const b=(f=this.parentElement)==null?void 0:f.querySelector(`${d}[triggerid="${o}"]`);b&&(b.showPopover(),t=!0)}break}case r.ARROW_LEFT:{P(this.parentElement)&&(this.hidePopover(),this.resetTabIndexAndSetFocus(0,s),t=!0);break}case r.ESCAPE:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case r.ENTER:{this.closeMenu(i),t=!0;break}case r.SPACE:{t=!0;break}}t&&(e.stopPropagation(),e.preventDefault())}handleKeyUp(e){let t=!1;const i=e.target;switch(e.key){case r.SPACE:{i.matches(`${k}, ${C}`)||(this.closeMenu(i),t=!0);break}}t&&(e.stopPropagation(),e.preventDefault())}};p.styles=[...I.styles,...R];let u=p;L([T({type:String,reflect:!0})],u.prototype,"placement");u.register(d);
