import{i as C,k as V}from"./lit-element-D5KKan5q.js";import{u as N,n as w,C as O}from"./index-C9z9WAEj.js";import{R as f}from"./roles-DMFGbP5t.js";import{o as y}from"./query-assigned-elements-uEuc3rg8.js";import{T as k}from"./menu.constants-Bt64zAlX.js";import{T as S}from"./menuitem.component-CN4VxgDp.js";import{T as _}from"./menuitemcheckbox.constants-Cja4JgF_.js";import{T as H}from"./menuitemradio.constants-DzN5_ujm.js";import{T as F}from"./menusection.constants-CectB7Mc.js";import{a as c,P as E}from"./popover.component-CLVcAiaC.js";import{K as l}from"./listitem.component-Czrm8EVj.js";const R=N.constructTagName("menubar"),a={HORIZONTAL:"horizontal",VERTICAL:"vertical"},I=N.constructTagName("menupopover");var B=Object.defineProperty,x=(d,o,u,e)=>{for(var t=void 0,s=d.length-1,i;s>=0;s--)(i=d[s])&&(t=i(o,u,t)||t);return t&&B(o,u,t),t};const L=d=>{class o extends d{constructor(){super(...arguments),this.ariaOrientation=a.HORIZONTAL}get menuItems(){var s;const e=(s=this.shadowRoot)==null?void 0:s.querySelector("slot");return((e==null?void 0:e.assignedElements({flatten:!0}))||[]).map(i=>i.tagName.toLowerCase()===F?Array.from(i.children).filter(n=>this.isValidMenuItem(n)):this.isValidMenuItem(i)?i:[]).flat().filter(i=>!!i).filter(i=>!i.hasAttribute("disabled"))}firstUpdated(e){super.firstUpdated(e),this.setMenuBarPopoverValue(!1),this.resetTabIndexAndSetActiveTabIndex(this.menuItems)}setMenuBarPopoverValue(e){const{menu:t}=this.getParentMenuItemDetails("",this);t==null||t.setAttribute("data-menu-popover-open",e.toString())}isMenuPopoverOpen(){const{menu:e}=this.getParentMenuItemDetails("",this);return(e==null?void 0:e.getAttribute("data-menu-popover-open"))==="true"}getCurrentIndex(e){return this.menuItems.findIndex(t=>t===e||t===e.parentElement)}updatePopoverPlacementBasedOnOrientation(){this.ariaOrientation===a.HORIZONTAL?this.menuPopoverItems.forEach(e=>{e.setAttribute("placement",c.BOTTOM_START)}):this.menuPopoverItems.forEach(e=>{e.setAttribute("placement",c.RIGHT_START)})}updateTabIndexAndFocusNewIndex(e,t,s){var i,n,r,h;if(!(s<0||t<0)){if(t===s){(i=e[t])==null||i.focus();return}(n=e[t])==null||n.setAttribute("tabindex","-1"),(r=e[s])==null||r.setAttribute("tabindex","0"),(h=e[s])==null||h.focus()}}isValidMenu(e){return(e==null?void 0:e.toLowerCase())===k||(e==null?void 0:e.toLowerCase())===R}isValidPopover(e){return(e==null?void 0:e.toLowerCase())===I}openPopover(e){var t,s;if(this.isValidPopover((s=(t=this.menuItems[e])==null?void 0:t.nextElementSibling)==null?void 0:s.tagName)){const i=this.menuItems[e].getAttribute("id"),n=this.menuPopoverItems.findIndex(r=>r.getAttribute("triggerid")===i);if(n!==-1)return this.menuPopoverItems[n].hasAttribute("visible")||this.menuPopoverItems[n].toggleAttribute("visible"),this.setMenuBarPopoverValue(!0),!0}return!1}navigateToPrevMenuItem(e,t,s,i){const n=e===t?s:e-1;this.updateTabIndexAndFocusNewIndex(this.menuItems,e,n),this.isMenuPopoverOpen()&&i===a.HORIZONTAL&&this.openPopover(n)}navigateToNextMenuItem(e,t,s,i){const n=e===s?t:e+1;this.updateTabIndexAndFocusNewIndex(this.menuItems,e,n),this.isMenuPopoverOpen()&&i===a.HORIZONTAL&&this.openPopover(n)}getParentMenuItemDetails(e,t){var s;return t&&this.isValidMenu(t.tagName)?{menu:t,menuChildId:e}:this.getParentMenuItemDetails(((s=t==null?void 0:t.previousElementSibling)==null?void 0:s.getAttribute("id"))??"",t==null?void 0:t.parentElement)}hideAllPopovers(e){if(!this.isValidMenu(e==null?void 0:e.tagName)){if(this.isValidPopover(e==null?void 0:e.tagName)&&(e==null||e.toggleAttribute("visible")),e!=null&&e.children){const t=Array.from(e.children).filter(s=>this.isValidMenuItem(s));this.resetTabIndexAndSetActiveTabIndex(t)}e!=null&&e.parentElement&&this.hideAllPopovers(e.parentElement)}}navigateToPrevParentMenuItem(e,t){var h,p,P,b,g;const s=(h=this.menuItems[e].parentElement)==null?void 0:h.previousElementSibling,i=Array.from(((p=this.parentElement)==null?void 0:p.children)||[]).filter(m=>this.isValidMenuItem(m)),n=i.findIndex(m=>m===s);let r=n;t===l.ARROW_LEFT&&this.isValidMenu((P=this.parentElement)==null?void 0:P.tagName)&&(r=n-1),this.updateTabIndexAndFocusNewIndex(i,n,r),t===l.ARROW_LEFT&&((g=(b=i[n-1])==null?void 0:b.nextElementSibling)==null||g.toggleAttribute("visible"))}closePopoverAndNavigateToPrevParentMenuItem(e,t){this.toggleAttribute("visible"),this.navigateToPrevParentMenuItem(e,t)}getParentMenuContents(e){var i;const t=this.getParentMenuItemDetails("",e),s=Array.from(((i=t.menu)==null?void 0:i.children)||[]).filter(n=>this.isValidMenuItem(n));return{parentMenuItemDetails:t,parentMenuItemsChildren:s}}setFocusToParentMenuItem(e){var i;const{parentMenuItemDetails:t,parentMenuItemsChildren:s}=this.getParentMenuContents(e);t!=null&&t.menuChildId&&((i=s.filter(r=>r.getAttribute("id")===t.menuChildId)[0])==null||i.focus())}openPopoverAndNavigateToNextChildrenMenuItem(e){var r,h;if(this.openPopover(e))return;this.hideAllPopovers(this.menuItems[e]);const{parentMenuItemDetails:t,parentMenuItemsChildren:s}=this.getParentMenuContents(this.menuItems[e]);if(s.length===0||(t==null?void 0:t.menuChildId)===""){this.navigateToNextMenuItem(e,0,this.menuItems.length-1,this.ariaOrientation);return}const i=s.findIndex(p=>p.getAttribute("id")===(t==null?void 0:t.menuChildId)),n=i===-1?e+1:i+1;this.updateTabIndexAndFocusNewIndex(s,i,n),(h=(r=s[n])==null?void 0:r.nextElementSibling)==null||h.toggleAttribute("visible")}isValidMenuItem(e){var t;return[S,_,H].includes((t=e.tagName)==null?void 0:t.toLowerCase())}resetTabIndexAndSetActiveTabIndex(e){e.forEach((t,s)=>{const i=s===0?"0":"-1";t==null||t.setAttribute("tabindex",i)})}handleKeyDown(e){var n,r;const s=this.menuItems.length-1,i=this.getCurrentIndex(e.target);if(i!==-1)switch(e.key){case l.HOME:this.updateTabIndexAndFocusNewIndex(this.menuItems,i,0);break;case l.END:this.updateTabIndexAndFocusNewIndex(this.menuItems,i,s);break;case l.ARROW_LEFT:{this.ariaOrientation===a.HORIZONTAL&&this.navigateToPrevMenuItem(i,0,s,this.ariaOrientation),this.ariaOrientation===a.VERTICAL&&this.closePopoverAndNavigateToPrevParentMenuItem(i,e.key);break}case l.ARROW_RIGHT:{this.ariaOrientation===a.HORIZONTAL&&this.navigateToNextMenuItem(i,0,s,this.ariaOrientation),this.ariaOrientation===a.VERTICAL&&this.openPopoverAndNavigateToNextChildrenMenuItem(i);break}case l.ARROW_UP:{this.ariaOrientation===a.HORIZONTAL&&this.openPopover(i),this.ariaOrientation===a.VERTICAL&&this.navigateToPrevMenuItem(i,0,s,this.ariaOrientation),e.preventDefault();break}case l.ARROW_DOWN:{this.ariaOrientation===a.HORIZONTAL&&this.openPopover(i),this.ariaOrientation===a.VERTICAL&&this.navigateToNextMenuItem(i,0,s,this.ariaOrientation),e.preventDefault();break}case l.SPACE:case l.ENTER:{this.isValidPopover((r=(n=this.menuItems[i])==null?void 0:n.nextElementSibling)==null?void 0:r.tagName)?this.openPopoverAndNavigateToNextChildrenMenuItem(i):this.isValidMenuItem(e.target)&&(this.setMenuBarPopoverValue(!1),this.setFocusToParentMenuItem(this.menuItems[i]));break}case l.ESCAPE:{this.setMenuBarPopoverValue(!1),this.ariaOrientation===a.VERTICAL&&this.navigateToPrevParentMenuItem(i,e.key);break}}}closeAllPopoversExceptCurrent(e){this.menuPopoverItems.filter(t=>t!==this.menuItems[e]).filter(t=>t.hasAttribute("visible")).forEach(t=>t.toggleAttribute("visible"))}handleMouseClick(e){var i,n;const t=e.target,s=this.getCurrentIndex(t);s!==-1&&(this.isValidPopover((n=(i=this.menuItems[s])==null?void 0:i.nextElementSibling)==null?void 0:n.tagName)?(this.closeAllPopoversExceptCurrent(s),this.openPopoverAndNavigateToNextChildrenMenuItem(s)):this.isValidMenuItem(t)&&this.hideAllPopovers(this.menuItems[s]))}}return x([w({type:String,reflect:!0,attribute:"aria-orientation"})],o.prototype,"ariaOrientation"),x([y({selector:`${I}:not([disabled])`})],o.prototype,"menuPopoverItems"),o},G=C`
  :host {
    display: flex;
  }

  :host([aria-orientation='horizontal']) {
    flex-direction: row;
  }

  :host([aria-orientation='vertical']) {
    flex-direction: column;
  }
`,$=[G],T=class T extends L(O){constructor(){super(),this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("click",this.handleMouseClick)}connectedCallback(){super.connectedCallback(),this.role=f.MENUBAR}update(o){super.update(o),o.has("ariaOrientation")&&this.updatePopoverPlacementBasedOnOrientation()}render(){return V`<slot></slot>`}};T.styles=[...O.styles,...$];let A=T;A.register(R);const D=C`
  :host::part(popover-content) {
    padding: 0.75rem 0.5rem;
  }
`,Z=[D],M=class M extends L(E){constructor(){super(),this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("click",this.handleMouseClick)}connectedCallback(){super.connectedCallback(),this.role=f.MENU,this.focusTrap=!0,this.hideOnEscape=!0,this.hideOnOutsideClick=!0,this.placement=c.BOTTOM_START,this.showArrow=!1,this.interactive=!0,this.ariaOrientation=a.VERTICAL}async firstUpdated(o){var u,e,t;await super.firstUpdated(o),(u=this.triggerElement)==null||u.setAttribute("aria-haspopup",f.MENU),((t=(e=this.parentElement)==null?void 0:e.tagName)==null?void 0:t.toLowerCase())===I&&(this.interactive=!0,this.placement=c.RIGHT_START)}};M.styles=[...E.styles,...Z];let v=M;v.register(I);export{a as O};
