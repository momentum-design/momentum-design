import{n as I}from"./property-Bj3TGwkg.js";import{K as r}from"./keys-hFXe221I.js";import{R as u}from"./roles-CJI3JVG-.js";import{a as A,T as M}from"./menuitemradio.constants-CB6EqhSm.js";import{b as m,d as f,c as T}from"./menupopover.constants-D-QmZHRh.js";import{T as b}from"./menuitem.component-CHNjJbYA.js";import{T as O}from"./menuitemcheckbox.constants-dhHMuWzH.js";import{P as g,p as h,C as v}from"./popover.component-BXNlzYwZ.js";import{i as S}from"./lit-element-D5KKan5q.js";const k=S`
  :host::part(popover-content) {
    padding: 0.75rem 0.5rem;
  }

  ::slotted(mdc-divider) {
    margin-block: 0.25rem;
  }
`,P=[k],c=n=>{var t;if(!n)return!1;const e=(t=n.getAttribute("role"))==null?void 0:t.toLowerCase();return e===u.MENUITEM||e===u.MENUITEMCHECKBOX||e===u.MENUITEMRADIO},E=n=>{var e;return((e=n==null?void 0:n.tagName)==null?void 0:e.toLowerCase())===m};var C=Object.defineProperty,y=(n,e,t,i)=>{for(var s=void 0,a=n.length-1,d;a>=0;a--)(d=n[a])&&(s=d(e,t,s)||s);return s&&C(e,t,s),s};const p=class p extends g{constructor(){super(),this.placement=f.PLACEMENT,this.menuItems=[],this.menuItemsWithSubMenus=[],this.onOutsidePopoverClick=e=>{if(h.peek()!==this)return;const t=e.composedPath(),i=this.contains(e.target)||t.includes(this.triggerElement)||t.includes(this),s=this.backdropElement?t.includes(this.backdropElement):!1;(!i||s)&&this.closeAllMenuPopovers()},this.togglePopoverVisible=()=>{var e;(e=this.triggerElement)!=null&&e.hasAttribute("soft-disabled")||(this.visible?this.hide():this.show())},this.handleItemCreation=e=>{const t=e.target;c(t)&&(e.stopImmediatePropagation(),t.addEventListener("destroyed",this.handleItemChangeEvent),t.addEventListener("disabled",this.handleItemChangeEvent))},this.handleItemChangeEvent=e=>{e.stopImmediatePropagation(),e.target&&e.type==="destroyed"&&(e.target.removeEventListener("destroyed",this.handleItemChangeEvent),e.target.removeEventListener("disabled",this.handleItemChangeEvent)),this.resetMenuNavigation()},this.resetMenuNavigation=()=>{this.collectMenuItems(),this.menuItems.find(t=>t.getAttribute("tabindex")==="0")||this.resetTabIndexes(0)},this.handleKeyDown=e=>{let t=!1;this.collectMenuItems();const i=e.target,s=this.getCurrentIndex(i);if(s===-1)return;this.resetTabIndexes(s);const a=window.getComputedStyle(this).direction==="rtl";switch(this.resolveDirectionKey(e.key,a)){case r.HOME:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case r.END:{this.resetTabIndexAndSetFocus(this.menuItems.length-1,s),t=!0;break}case r.ARROW_DOWN:{const o=s+1===this.menuItems.length?0:s+1;this.resetTabIndexAndSetFocus(o,s),t=!0;break}case r.ARROW_UP:{const o=s-1===-1?this.menuItems.length-1:s-1;this.resetTabIndexAndSetFocus(o,s),t=!0;break}case r.ARROW_RIGHT:{const o=this.getSubMenuPopoverOfTarget(i);o&&(o.show(),t=!0);break}case r.ARROW_LEFT:{E(this.parentElement)&&(this.hide(),this.resetTabIndexAndSetFocus(0,s),t=!0);break}case r.ESCAPE:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case r.ENTER:{this.getSubMenuPopoverOfTarget(i)||(this.closeAllMenuPopovers(),this.fireMenuItemAction(i),t=!0);break}case r.SPACE:{t=!0;break}}t&&(e.stopPropagation(),e.preventDefault())},this.handleKeyUp=e=>{let t=!1;const i=e.target;switch(e.key){case r.SPACE:{i.matches(`${A}, ${O}`)||this.getSubMenuPopoverOfTarget(i)||(this.closeAllMenuPopovers(),this.fireMenuItemAction(i),t=!0);break}}t&&(e.stopPropagation(),e.preventDefault())},this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("keyup",this.handleKeyUp),this.addEventListener("click",this.handleMouseClick),this.addEventListener("created",this.handleItemCreation)}getSubMenuPopoverOfTarget(e){var i,s;const t=e.getAttribute("id");return t?(s=(i=this.parentElement)==null?void 0:i.querySelector)==null?void 0:s.call(i,`${m}[triggerid="${t}"]`):null}collectMenuItems(){var i;const e=(i=this.shadowRoot)==null?void 0:i.querySelector("slot"),t=(e==null?void 0:e.assignedElements({flatten:!0}))||[];this.menuItems=t.map(s=>s.tagName.toLowerCase()===M?Array.from(s.children).filter(a=>c(a)):c(s)?s:[]).flat().filter(s=>!!s&&!s.hasAttribute("disabled")),this.menuItemsWithSubMenus=this.menuItems.filter(s=>this.getSubMenuPopoverOfTarget(s))}getOpenSubMenusOfItems(e){const t=[];return!e||e.length===0||e.forEach(i=>{const s=this.getSubMenuPopoverOfTarget(i);s&&s.visible&&t.push(s)}),t}connectedCallback(){super.connectedCallback(),this.role=u.MENU,this.ariaOrientation=f.ORIENTATION,this.backdrop=!1,this.color=v.TONAL,this.disableAriaExpanded=!1,this.focusBackToTrigger=!0,this.focusTrap=!0,this.hideOnEscape=!0,this.hideOnOutsideClick=!0,this.interactive=!0,this.showArrow=!1,this.closeButton=!1,this.closeButtonAriaLabel=null}async isOpenUpdated(e,t){return e===t||!this.triggerElement?Promise.resolve():(t&&(this.backdrop=![b,T].includes(this.triggerElement.tagName.toLowerCase())),t===!1&&this.menuItemsWithSubMenus.forEach(i=>{const s=this.getSubMenuPopoverOfTarget(i);s&&s.hide()}),this.resetMenuNavigation(),super.isOpenUpdated(e,t))}async firstUpdated(e){var t;await super.firstUpdated(e),this.collectMenuItems(),this.resetTabIndexes(0),(t=this.triggerElement)==null||t.setAttribute("aria-haspopup",u.MENU)}resetTabIndexes(e){this.menuItems.length>0&&(this.menuItems.forEach(t=>t.setAttribute("tabindex","-1")),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}getCurrentIndex(e){return this.menuItems.findIndex(t=>t===e)}resetTabIndexAndSetFocus(e,t){e!==t&&(this.menuItems[t].setAttribute("tabindex","-1"),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}closeAllMenuPopovers(e){for(;h.peek()!==e&&E(h.peek());){const t=h.pop();if(t)t.hide();else break}}closeOtherSubMenusOnSameLevel(e){const t=this.menuItemsWithSubMenus.filter(s=>s!==e);this.getOpenSubMenusOfItems(t).forEach(s=>{s.hide()})}fireMenuItemAction(e){e.matches(b)&&e.dispatchEvent(new Event("action",{bubbles:!0,composed:!0}))}handleMouseClick(e){const t=e.target;if(e.stopPropagation(),!(!c(t)||!e.isTrusted)){if(this.getSubMenuPopoverOfTarget(t)){this.closeOtherSubMenusOnSameLevel(t);return}this.closeAllMenuPopovers(),this.fireMenuItemAction(t)}}resolveDirectionKey(e,t){if(!t)return e;switch(e){case r.ARROW_LEFT:return r.ARROW_RIGHT;case r.ARROW_RIGHT:return r.ARROW_LEFT;default:return e}}};p.styles=[...g.styles,...P];let l=p;y([I({type:String,reflect:!0})],l.prototype,"placement");l.register(m);
