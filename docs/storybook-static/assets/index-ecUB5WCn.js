import{U as E,R as c,n as I}from"./iframe-DD1qd397.js";import{a as A,T as M}from"./menuitemradio.constants-CVotw9jq.js";import{b as d,d as f,c as T}from"./menupopover.constants-DXUrEb0k.js";import{T as p}from"./menuitem.component-mm0yiwdJ.js";import{T as v}from"./menuitemcheckbox.constants-Co63qMPc.js";import{P as b,p as u}from"./popover.component-Dn23zOyI.js";import{C as O}from"./popover.constants-IjUFgXmU.js";import{A as r}from"./KeyToActionMixin-D7mKMv1X.js";const S=E`
  :host::part(popover-content) {
    padding: 0.75rem 0.5rem;
  }

  ::slotted(mdc-divider) {
    margin-block: 0.25rem;
  }
`,k=[S],h=n=>{var t;if(!n)return!1;const e=(t=n.getAttribute("role"))==null?void 0:t.toLowerCase();return e===c.MENUITEM||e===c.MENUITEMCHECKBOX||e===c.MENUITEMRADIO},g=n=>{var e;return((e=n==null?void 0:n.tagName)==null?void 0:e.toLowerCase())===d};var P=Object.defineProperty,C=(n,e,t,i)=>{for(var s=void 0,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=a(e,t,s)||s);return s&&P(e,t,s),s};const m=class m extends b{constructor(){super(),this.placement=f.PLACEMENT,this.menuItems=[],this.menuItemsWithSubMenus=[],this.onOutsidePopoverClick=e=>{if(u.peek()!==this)return;const t=e.composedPath(),i=this.contains(e.target)||t.includes(this.triggerElement)||t.includes(this),s=this.backdropElement?t.includes(this.backdropElement):!1;(!i||s)&&this.closeAllMenuPopovers()},this.togglePopoverVisible=e=>{var t;(t=this.triggerElement)!=null&&t.hasAttribute("soft-disabled")||!this.isEventFromTrigger(e)||(this.visible?this.hide():this.show())},this.handleItemCreation=e=>{const t=e.target;h(t)&&(e.stopImmediatePropagation(),t.addEventListener("destroyed",this.handleItemChangeEvent),t.addEventListener("disabled",this.handleItemChangeEvent))},this.handleItemChangeEvent=e=>{e.stopImmediatePropagation(),e.target&&e.type==="destroyed"&&(e.target.removeEventListener("destroyed",this.handleItemChangeEvent),e.target.removeEventListener("disabled",this.handleItemChangeEvent)),this.resetMenuNavigation()},this.resetMenuNavigation=()=>{this.collectMenuItems(),this.menuItems.find(t=>t.getAttribute("tabindex")==="0")||this.resetTabIndexes(0)},this.handleKeyDown=e=>{let t=!1;this.collectMenuItems();const i=e.target,s=this.getCurrentIndex(i);if(s===-1)return;switch(this.resetTabIndexes(s),this.getActionForKeyEvent(e,!0)){case r.HOME:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case r.END:{this.resetTabIndexAndSetFocus(this.menuItems.length-1,s),t=!0;break}case r.DOWN:{const a=s+1===this.menuItems.length?0:s+1;this.resetTabIndexAndSetFocus(a,s),t=!0;break}case r.UP:{const a=s-1===-1?this.menuItems.length-1:s-1;this.resetTabIndexAndSetFocus(a,s),t=!0;break}case r.RIGHT:{const a=this.getSubMenuPopoverOfTarget(i);a&&(a.show(),t=!0);break}case r.LEFT:{g(this.parentElement)&&(this.hide(),this.resetTabIndexAndSetFocus(0,s),t=!0);break}case r.ESCAPE:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case r.ENTER:{!this.getSubMenuPopoverOfTarget(i)&&!i.hasAttribute("soft-disabled")&&(this.closeAllMenuPopovers(),this.fireMenuItemAction(i),t=!0);break}case r.SPACE:{t=!0;break}}t&&(e.stopPropagation(),e.preventDefault())},this.handleKeyUp=e=>{let t=!1;const i=e.target;switch(this.getActionForKeyEvent(e)){case r.SPACE:{!i.matches(`${A}, ${v}`)&&!i.hasAttribute("soft-disabled")&&(this.getSubMenuPopoverOfTarget(i)||(this.closeAllMenuPopovers(),this.fireMenuItemAction(i),t=!0));break}}t&&(e.stopPropagation(),e.preventDefault())},this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("keyup",this.handleKeyUp),this.addEventListener("click",this.handleMouseClick),this.addEventListener("created",this.handleItemCreation)}getSubMenuPopoverOfTarget(e){var i,s;const t=e.getAttribute("id");return t?(s=(i=this.parentElement)==null?void 0:i.querySelector)==null?void 0:s.call(i,`${d}[triggerid="${t}"]`):null}collectMenuItems(){var i;const e=(i=this.shadowRoot)==null?void 0:i.querySelector("slot"),t=(e==null?void 0:e.assignedElements({flatten:!0}))||[];this.menuItems=t.map(s=>s.tagName.toLowerCase()===M?Array.from(s.children).filter(o=>h(o)):h(s)?s:[]).flat().filter(s=>!!s&&!s.hasAttribute("disabled")),this.menuItemsWithSubMenus=this.menuItems.filter(s=>this.getSubMenuPopoverOfTarget(s))}getOpenSubMenusOfItems(e){const t=[];return!e||e.length===0||e.forEach(i=>{const s=this.getSubMenuPopoverOfTarget(i);s&&s.visible&&t.push(s)}),t}connectedCallback(){super.connectedCallback(),this.role=c.MENU,this.ariaOrientation=f.ORIENTATION,this.backdrop=!1,this.color=O.TONAL,this.disableAriaExpanded=!1,this.focusBackToTrigger=!0,this.focusTrap=!0,this.hideOnEscape=!0,this.hideOnOutsideClick=!0,this.interactive=!0,this.showArrow=!1,this.closeButton=!1,this.closeButtonAriaLabel=null}async isOpenUpdated(e,t){return e===t||!this.triggerElement?Promise.resolve():(t&&(this.backdrop=![p,T].includes(this.triggerElement.tagName.toLowerCase())),t===!1&&this.menuItemsWithSubMenus.forEach(i=>{const s=this.getSubMenuPopoverOfTarget(i);s&&s.hide()}),this.resetMenuNavigation(),super.isOpenUpdated(e,t))}async firstUpdated(e){await super.firstUpdated(e),this.collectMenuItems(),this.resetTabIndexes(0)}resetTabIndexes(e){this.menuItems.length>0&&(this.menuItems.forEach(t=>t.setAttribute("tabindex","-1")),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}getCurrentIndex(e){return this.menuItems.findIndex(t=>t===e)}resetTabIndexAndSetFocus(e,t){e!==t&&(this.menuItems[t].setAttribute("tabindex","-1"),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}closeAllMenuPopovers(e){for(;u.peek()!==e&&g(u.peek());){const t=u.pop();if(t)t.hide();else break}}closeOtherSubMenusOnSameLevel(e){const t=this.menuItemsWithSubMenus.filter(s=>s!==e);this.getOpenSubMenusOfItems(t).forEach(s=>{s.hide()})}fireMenuItemAction(e){e.matches(p)&&e.dispatchEvent(new Event("action",{bubbles:!0,composed:!0}))}handleMouseClick(e){const t=e.target;if(e.stopPropagation(),!(!h(t)||!e.isTrusted||t.hasAttribute("soft-disabled"))){if(this.getSubMenuPopoverOfTarget(t)){this.closeOtherSubMenusOnSameLevel(t);return}this.closeAllMenuPopovers(),this.fireMenuItemAction(t)}}};m.styles=[...b.styles,...k];let l=m;C([I({type:String,reflect:!0})],l.prototype,"placement");l.register(d);
