import{i as I,k as A}from"./lit-element-D5KKan5q.js";import{u as b,C as f}from"./index-C9z9WAEj.js";import{R as a}from"./roles-BH_hBfTz.js";import{p,P as T}from"./popover.component-CIRgyPMB.js";import{T as u}from"./menupopover.constants-Buvjf1TJ.js";import{T as g}from"./menuitemradio.constants-DITJZH4C.js";import{T as m}from"./sidenavigation.component-pGZohoft.js";import{K as o}from"./listitem.component-Cf11XHay.js";const h=b.constructTagName("menubar"),E={ORIENTATION:"vertical"},M=I`
  :host {
    display: flex;
  }

  :host([aria-orientation='horizontal']) {
    flex-direction: row;
  }

  :host([aria-orientation='vertical']) {
    flex-direction: column;
  }
`,R=[M],d=class d extends f{constructor(){super(),this.addEventListener("keydown",this.handleKeyDown)}connectedCallback(){super.connectedCallback(),this.role=a.MENUBAR,this.ariaOrientation=E.ORIENTATION}get menuItems(){var n;const t=(n=this.shadowRoot)==null?void 0:n.querySelector("slot"),e=(t==null?void 0:t.assignedElements({flatten:!0}))??[],s=[],i=r=>{r.role===a.MENUITEM&&!r.hasAttribute("disabled")?s.push(r):r.tagName.toLowerCase()===g&&Array.from(r.children).forEach(i)};return e.forEach(i),s}getAllPopovers(){var i;if(!this.menuItems.length)return[];const t=((i=this.menuItems[0])==null?void 0:i.closest(m))??this;if(!t)return[];const e=[],s=n=>{n.querySelectorAll(`${u}`).forEach(r=>{e.push(r)}),n.querySelectorAll("slot").forEach(r=>{r.assignedElements({flatten:!0}).forEach(s)})};return s(t),e}update(t){super.update(t)}firstUpdated(t){super.firstUpdated(t),this.resetTabIndexAndSetActiveTabIndex(this.menuItems),this.updatePopoverPlacement()}resetTabIndexAndSetActiveTabIndex(t){t.forEach((e,s)=>{const i=s===0?"0":"-1";e==null||e.setAttribute("tabindex",i)})}getCurrentIndex(t){return this.menuItems.findIndex(e=>e===t||e===t.parentElement)}getSubmenu(t){if(t)return this.getAllPopovers().find(e=>e.getAttribute("triggerid")===t)}showSubmenu(t){if(!t||!this.menuItems.find(i=>i.getAttribute("id")===t))return;const s=this.getSubmenu(t);s&&s.showPopover()}updatePopoverPlacement(){const t=T.RIGHT_START;this.getAllPopovers().forEach(e=>{e.setAttribute("placement",t)})}updateTabIndexAndFocus(t,e,s){var i,n,r;s<0||e<0||(e!==s&&((i=t[e])==null||i.setAttribute("tabindex","-1"),(n=t[s])==null||n.setAttribute("tabindex","0")),(r=t[s])==null||r.focus())}navigateToMenuItem(t,e,s=!1){var r;const{length:i}=this.menuItems;if(i===0)return;let n=t;if(n=e==="prev"?(t-1+i)%i:(t+1)%i,this.updateTabIndexAndFocus(this.menuItems,t,n),s){const c=(r=this.menuItems[n])==null?void 0:r.getAttribute("id");this.getSubmenu(c)&&!this.menuItems[n].hasAttribute("soft-disabled")&&this.showSubmenu(c)}}getKeyWithDirectionFix(t){return window.getComputedStyle(this).direction==="rtl"?t===o.ARROW_LEFT?o.ARROW_RIGHT:t===o.ARROW_RIGHT?o.ARROW_LEFT:t:t}isTopLevelMenuItem(t){var n;const e=t.parentElement;if(!e||t.role!==a.MENUITEM)return!1;const s=e.tagName.toLowerCase(),i=(n=e.parentElement)==null?void 0:n.tagName.toLowerCase();return s===h||s===m||s===g&&(i===h||i===m)}isNestedMenuItem(t){return!!t.closest(u)&&t.role===a.MENUITEM}async closeAllMenuPopovers(){const t=[];for(;p.peek();){const e=p.pop();e&&(e.hidePopover(),t.push(e))}await Promise.all(t.map(e=>e.updateComplete))}async crossMenubarNavigationOnLeft(t){if(t.role===a.MENUITEM){const s=t.closest(u),i=s==null?void 0:s.getAttribute("triggerid"),n=this.menuItems.find(r=>r.getAttribute("id")===i);if(n){this.isTopLevelMenuItem(n)&&(s==null||s.hidePopover()),await(s==null?void 0:s.updateComplete);const r=this.getCurrentIndex(n);this.navigateToMenuItem(r,"prev",!0)}}}async crossMenubarNavigationOnRight(t){if(this.isTopLevelMenuItem(t)&&this.getSubmenu(t.id)&&!t.hasAttribute("soft-disabled"))this.showSubmenu(t.id);else if(this.isNestedMenuItem(t)&&!this.getSubmenu(t.id)){await this.closeAllMenuPopovers();const e=this.getParentMenuItemIndex(t);e>=0&&this.navigateToMenuItem(e,"next",!0)}}getParentMenuItemIndex(t){let e=t.parentElement;for(;e;){if(e.tagName.toLowerCase()===u){const s=e.getAttribute("triggerid"),i=this.menuItems.find(n=>n.getAttribute("id")===s);if(i)return this.isTopLevelMenuItem(i)?this.menuItems.findIndex(n=>n===i):this.getParentMenuItemIndex(i)}e=e.parentElement}return-1}async handleKeyDown(t){const e=this.getCurrentIndex(t.target);switch(this.getKeyWithDirectionFix(t.key)){case o.HOME:this.updateTabIndexAndFocus(this.menuItems,e,0);break;case o.END:this.updateTabIndexAndFocus(this.menuItems,e,this.menuItems.length-1);break;case o.ARROW_LEFT:{const i=e>=0?this.menuItems[e]:t.target;await this.crossMenubarNavigationOnLeft(i);break}case o.ARROW_RIGHT:{const i=e>=0?this.menuItems[e]:t.target;await this.crossMenubarNavigationOnRight(i);break}case o.ARROW_UP:{this.navigateToMenuItem(e,"prev"),t.preventDefault();break}case o.ARROW_DOWN:{this.navigateToMenuItem(e,"next"),t.preventDefault();break}}}render(){return A`<slot role="${a.GROUP}"></slot>`}};d.styles=[...f.styles,...R];let l=d;l.register(h);
