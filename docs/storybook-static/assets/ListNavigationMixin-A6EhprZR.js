import{C as l,s as u}from"./iframe-Dhby1e8T.js";import{K as f,a as I,A as o,N as m}from"./KeyDownHandledMixin-DWH9e7-q.js";import{a as v}from"./listitem.component-1X9rPhx3.js";const p=d=>{class h extends f(I(d)){constructor(...n){super(...n),this.loop="true",this.propagateAllKeyEvents=!1,this.initialFocus=0,this.handleItemCreation=e=>{const{target:s}=e;this.navItems.length===0&&s instanceof l&&s.setAttribute("tabindex","0")},this.handleNavigationClick=e=>{const s=e.target,i=this.getCurrentIndex(s);if(i!==-1){const t=!(this.navItems.at(i)!==s&&document.activeElement===e.target);this.resetTabIndexAndSetFocus(i,void 0,t,!1)}},this.handleNavBeforeFocus=e=>{const s=u(e.relatedTarget);if(this!==s&&!this.contains(document.activeElement)&&this.contains(s)){e.preventDefault();const i=this.navItems.find(a=>a.contains(s)),t=this.getCurrentIndex(i);if(t===-1)return;this.resetTabIndexes(t)}},this.addEventListener(v.CREATED,this.handleItemCreation),this.addEventListener("keydown",this.handleNavigationKeyDown.bind(this)),this.addEventListener("click",this.handleNavigationClick)}connectedCallback(){super.connectedCallback(),document.addEventListener("navbeforefocus",this.handleNavBeforeFocus)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("navbeforefocus",this.handleNavBeforeFocus)}async firstUpdated(n){super.firstUpdated(n),this.setInitialFocus()}setInitialFocus(){const n=Math.max(Math.min(this.initialFocus,this.navItems.length-1),0);this.resetTabIndexAndSetFocus(n,void 0,!1)}handleNavigationKeyDown(n){const e=this.getActionForKeyEvent(n,!0),s=new Set([o.DOWN,o.UP,o.HOME,o.END]);if(!e||!s.has(e))return;const i=n.target,t=this.getCurrentIndex(i);if(t===-1)return;this.resetTabIndexes(t);let a=!1;switch(e){case o.HOME:{a=this.resetTabIndexAndSetFocus(0,t);break}case o.END:{a=this.resetTabIndexAndSetFocus(this.navItems.length-1,t);break}case o.DOWN:{const r=this.shouldLoop()?0:t,c=t+1===this.navItems.length?r:t+1;a=this.resetTabIndexAndSetFocus(c,t);break}case o.UP:{const r=this.shouldLoop()?this.navItems.length-1:t,c=t-1===-1?r:t-1;a=this.resetTabIndexAndSetFocus(c,t);break}}a&&(this.keyDownEventHandled(),this.propagateAllKeyEvents||(n.stopPropagation(),n.preventDefault()))}getCurrentIndex(n){return n?this.navItems.findIndex(e=>e===n||!!(e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)):-1}resetTabIndexes(n,e=!0){if(this.navItems.length>0){this.navItems.forEach(t=>t.setAttribute("tabindex","-1"));const s=this.navItems.at(n)?n:0,i=this.navItems.at(s)??this.navItems.find(Boolean);i&&(i.setAttribute("tabindex","0"),e&&i.focus())}}resetTabIndexAndSetFocus(n,e,s=!0,i=!0){const{navItems:t}=this;if(t.length===0)return!1;const a=t.at(n)??t.find(Boolean);return n===e&&a&&a.getAttribute("tabindex")==="0"?!1:(e===void 0?t.forEach(r=>r.setAttribute("tabindex","-1")):t.at(e)&&t.at(e).setAttribute("tabindex","-1"),a.setAttribute("tabindex","0"),s&&(a.focus({preventScroll:!0}),i&&a.scrollIntoView({block:"nearest"})),!0)}shouldLoop(){return this.getKeyboardNavMode()===m.SPATIAL?!1:this.loop!=="false"}}return h};export{p as L};
