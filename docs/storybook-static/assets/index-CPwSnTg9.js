import{n as A}from"./index-C9z9WAEj.js";import{K as o}from"./listitem.component-BsBmhI_c.js";import{R as c}from"./roles-BH_hBfTz.js";import{T as E}from"./menuitem.component-BMelh1qR.js";import{T}from"./menusection.constants-BCYXL6dH.js";import{a as m,p as d,C as I}from"./popover.component-DRVNZbmp.js";import{T as l,D as f}from"./menupopover.constants-9M2YGSKC.js";import{i as k}from"./lit-element-D5KKan5q.js";const v=k`
  :host::part(popover-content) {
    padding: 0.75rem 0.5rem;
  }

  ::slotted(mdc-divider) {
    margin-block: 0.25rem;
  }
`,O=[v],b=r=>{var e;if(!r)return!1;const t=(e=r.getAttribute("role"))==null?void 0:e.toLowerCase();return t===c.MENUITEM||t===c.MENUITEMCHECKBOX||t===c.MENUITEMRADIO},R=r=>{var t;return((t=r==null?void 0:r.tagName)==null?void 0:t.toLowerCase())===l},C=r=>{var e;const t=(e=r==null?void 0:r.getAttribute("role"))==null?void 0:e.toLowerCase();return!!r&&t===c.MENUITEM&&!r.hasAttribute("disabled")};var M=Object.defineProperty,P=(r,t,e,i)=>{for(var s=void 0,n=r.length-1,h;n>=0;n--)(h=r[n])&&(s=h(t,e,s)||s);return s&&M(t,e,s),s};const p=class p extends m{constructor(){super(),this.placement=f.PLACEMENT,this.onOutsidePopoverClick=t=>{if(d.peek()!==this)return;const e=this.findClosestPopover(t.target);if(e&&d.has(e)){this.closeAllMenuPopovers(e);return}const i=t.composedPath(),s=this.contains(t.target)||i.includes(this.triggerElement),n=this.backdropElement?i.includes(this.backdropElement):!1;(!s||n)&&this.closeAllMenuPopovers()},this.togglePopoverVisible=()=>{var t;(t=this.triggerElement)!=null&&t.hasAttribute("soft-disabled")||(this.isTriggerClicked?this.hidePopover():(this.showPopover(),this.isTriggerClicked=!0))},this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("click",this.handleMouseClick)}get menuItems(){var i;const t=(i=this.shadowRoot)==null?void 0:i.querySelector("slot");return((t==null?void 0:t.assignedElements({flatten:!0}))||[]).map(s=>s.tagName.toLowerCase()===T?Array.from(s.children).filter(n=>b(n)):b(s)?s:[]).flat().filter(s=>!!s&&!s.hasAttribute("disabled"))}connectedCallback(){super.connectedCallback(),this.role=c.MENU,this.ariaOrientation=f.ORIENTATION,this.backdrop=!1,this.color=I.TONAL,this.disableAriaExpanded=!1,this.focusBackToTrigger=!0,this.focusTrap=!0,this.hideOnEscape=!0,this.hideOnOutsideClick=!0,this.interactive=!0,this.showArrow=!1,this.closeButton=!1,this.closeButtonAriaLabel=null}async isOpenUpdated(t,e){return t===e||!this.triggerElement?Promise.resolve():(e&&(this.backdrop=this.triggerElement.tagName.toLowerCase()!==E),super.isOpenUpdated(t,e))}async firstUpdated(t){var e;await super.firstUpdated(t),this.menuItems.length>0&&(this.menuItems.forEach(i=>i.setAttribute("tabindex","-1")),this.menuItems[0].setAttribute("tabindex","0")),(e=this.triggerElement)==null||e.setAttribute("aria-haspopup",c.MENU)}getCurrentIndex(t){return this.menuItems.findIndex(e=>e===t)}resetTabIndexAndSetFocus(t,e){t!==e&&(this.menuItems[e].setAttribute("tabindex","-1"),this.menuItems[t].setAttribute("tabindex","0"),this.menuItems[t].focus())}closeAllMenuPopovers(t){for(;d.peek()!==t;){const e=d.pop();if(e)e.hidePopover();else break}}hasSubmenuWithTriggerId(t){var e;return((e=this.parentElement)==null?void 0:e.querySelector(`${l}[triggerid="${t}"]`))!==null}handleMouseClick(t){const e=t.target,i=e.getAttribute("id");C(e)&&!this.hasSubmenuWithTriggerId(i)&&this===e.closest(l)&&(this.closeAllMenuPopovers(),e.dispatchEvent(new Event("action",{bubbles:!0,composed:!0})))}resolveDirectionKey(t,e){if(!e)return t;switch(t){case o.ARROW_LEFT:return o.ARROW_RIGHT;case o.ARROW_RIGHT:return o.ARROW_LEFT;default:return t}}handleKeyDown(t){var n,h;const e=this.getCurrentIndex(t.target);if(e===-1)return;const i=window.getComputedStyle(this).direction==="rtl";switch(this.resolveDirectionKey(t.key,i)){case o.HOME:{this.resetTabIndexAndSetFocus(0,e);break}case o.END:{this.resetTabIndexAndSetFocus(this.menuItems.length-1,e);break}case o.ARROW_DOWN:{const a=e+1===this.menuItems.length?0:e+1;this.resetTabIndexAndSetFocus(a,e);break}case o.ARROW_UP:{const a=e-1===-1?this.menuItems.length-1:e-1;this.resetTabIndexAndSetFocus(a,e);break}case o.ARROW_RIGHT:{const a=(n=this.menuItems[e])==null?void 0:n.getAttribute("id");if(this.hasSubmenuWithTriggerId(a)){const g=(h=this.parentElement)==null?void 0:h.querySelector(`${l}[triggerid="${a}"]`);g&&g.showPopover()}break}case o.ARROW_LEFT:{R(this.parentElement)&&(this.hidePopover(),this.resetTabIndexAndSetFocus(0,e));break}case o.ESCAPE:{this.resetTabIndexAndSetFocus(0,e);break}}}};p.styles=[...m.styles,...O];let u=p;P([A({type:String,reflect:!0})],u.prototype,"placement");u.register(l);
