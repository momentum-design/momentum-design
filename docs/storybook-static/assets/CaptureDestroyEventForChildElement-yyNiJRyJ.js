import{b as a}from"./listitem.component-DY0uLTU1.js";import{i as r,a as n}from"./dom-BlZvhF8F.js";const c=d=>!!d;class m{constructor(t,e){this.cache=[],this.itemCreationHandler=i=>{this.addItem(i.target,void 0)},this.itemDestroyHandler=i=>{this.delete(i.detail.originalTarget)},this.host=t,t.addController(this),this.isValidItem=(e==null?void 0:e.isValidItem)||c,this.onStoreUpdate=e==null?void 0:e.onStoreUpdate}get items(){return this.cache}hostConnected(){this.host.addEventListener(a.CREATED,this.itemCreationHandler),this.host.addEventListener(a.DESTROYED,this.itemDestroyHandler)}hostDisconnected(){this.host.removeEventListener(a.CREATED,this.itemCreationHandler),this.host.removeEventListener(a.DESTROYED,this.itemDestroyHandler),this.reset()}add(t){this.addItem(t,void 0)}addAt(t,e){this.addItem(t,e)}getIndexToInsertInCache(t){if(!this.cache.length||!r(this.cache.at(-1),t))return-1;let e=0,i=this.cache.length-1;for(;e<=i;){const s=Math.floor((e+i)/2);n(this.cache[s],t)?e=s+1:i=s-1}return e}addItem(t,e=void 0){var s;const i=t;if(this.isValidItem(i)&&!this.cache.includes(i)){const h=e===void 0?this.getIndexToInsertInCache(i):e;this.onStoreUpdate&&((s=this.onStoreUpdate)==null||s.call(this,i,"added",h===-1?this.cache.length:h,this.cache.slice())),h===-1?this.cache.push(i):h>=0&&this.cache.splice(h,0,i)}}delete(t){var i;const e=this.cache.indexOf(t);e!==-1&&(this.onStoreUpdate&&((i=this.onStoreUpdate)==null||i.call(this,t,"removed",e,this.cache.slice())),this.cache.splice(e,1))}reset(t){this.cache.length=0,t&&this.cache.push(...t)}}const E=d=>{class t extends d{constructor(...i){super(...i),this.handleItemCreation=s=>{const h=s.target;h&&h.addEventListener(a.DESTROYED,this.handleItemRemovedEvent)},this.handleItemRemovedEvent=s=>{s.stopImmediatePropagation(),s.target&&s.type===a.DESTROYED&&(s.target.removeEventListener(a.DESTROYED,this.handleItemRemovedEvent),this.dispatchEvent(new CustomEvent(s.type,{bubbles:s.bubbles,composed:s.composed,detail:{originalTarget:s.target}})))},this.addEventListener(a.CREATED,this.handleItemCreation)}}return t};export{E as C,m as E};
