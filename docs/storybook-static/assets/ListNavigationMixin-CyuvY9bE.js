import{C as u,s as f}from"./iframe-CqwCe3Q0.js";import{K as I,a as v,A as o,N as m}from"./KeyDownHandledMixin-Bkh1Su5p.js";import{a as b}from"./listitem.component-5iUha_4u.js";const A=h=>{class l extends I(v(h)){constructor(...e){super(...e),this.loop="true",this.propagateAllKeyEvents=!1,this.initialFocus=0,this.orientation="vertical",this.handleItemCreation=t=>{var s;const{target:i}=t,a=t instanceof CustomEvent&&((s=t.detail)==null?void 0:s.lifecycle);this.navItems.length===0&&i instanceof u&&a&&i.setAttribute("tabindex","0")},this.handleNavigationClick=t=>{const i=t.target,a=this.getCurrentIndex(i);if(a!==-1){const s=!(this.navItems.at(a)!==i&&document.activeElement===t.target);this.resetTabIndexAndSetFocus(a,void 0,s,!1)}},this.handleNavBeforeFocus=t=>{const i=f(t.relatedTarget);if(this!==i&&!this.contains(document.activeElement)&&this.contains(i)){t.preventDefault();const a=this.navItems.find(n=>n.contains(i)),s=this.getCurrentIndex(a);if(s===-1)return;this.resetTabIndexes(s)}},this.addEventListener(b.CREATED,this.handleItemCreation),this.addEventListener("keydown",this.handleNavigationKeyDown.bind(this)),this.addEventListener("click",this.handleNavigationClick)}connectedCallback(){super.connectedCallback(),document.addEventListener("navbeforefocus",this.handleNavBeforeFocus)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("navbeforefocus",this.handleNavBeforeFocus)}async firstUpdated(e){super.firstUpdated(e),this.setInitialFocus()}setInitialFocus(){const e=Math.max(Math.min(this.initialFocus,this.navItems.length-1),0);this.resetTabIndexAndSetFocus(e,void 0,!1)}handleNavigationKeyDown(e){const t=this.getActionForKeyEvent(e,!0),i=this.orientation==="vertical",a=new Set(i?[o.DOWN,o.UP,o.HOME,o.END]:[o.LEFT,o.RIGHT,o.HOME,o.END]);if(!t||!a.has(t))return;const s=e.target,n=this.getCurrentIndex(s);if(n===-1)return;this.resetTabIndexes(n);let r=!1;switch(t){case o.HOME:{r=this.resetTabIndexAndSetFocus(0,n);break}case o.END:{r=this.resetTabIndexAndSetFocus(this.navItems.length-1,n);break}case o.DOWN:case o.RIGHT:{const c=this.shouldLoop()?0:n,d=n+1===this.navItems.length?c:n+1;r=this.resetTabIndexAndSetFocus(d,n);break}case o.UP:case o.LEFT:{const c=this.shouldLoop()?this.navItems.length-1:n,d=n-1===-1?c:n-1;r=this.resetTabIndexAndSetFocus(d,n);break}}r&&(this.keyDownEventHandled(),this.propagateAllKeyEvents||(e.stopPropagation(),e.preventDefault()))}getCurrentIndex(e){return e?this.navItems.findIndex(t=>t===e||!!(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)):-1}resetTabIndexes(e,t=!0){if(this.navItems.length>0){this.navItems.forEach(s=>s.setAttribute("tabindex","-1"));const i=this.navItems.at(e)?e:0,a=this.navItems.at(i)??this.navItems.find(Boolean);a&&(a.setAttribute("tabindex","0"),t&&a.focus())}}resetTabIndexAndSetFocus(e,t,i=!0,a=!0){const{navItems:s}=this;if(s.length===0)return!1;const n=s.at(e)??s.find(Boolean);return e===t&&n&&n.getAttribute("tabindex")==="0"?!1:(t===void 0?s.forEach(r=>r.setAttribute("tabindex","-1")):s.at(t)&&s.at(t).setAttribute("tabindex","-1"),n.setAttribute("tabindex","0"),i&&(n.focus({preventScroll:!0}),a&&n.scrollIntoView({block:"nearest"})),!0)}shouldLoop(){return this.getKeyboardNavMode()===m.SPATIAL?!1:this.loop!=="false"}}return l};export{A as L};
