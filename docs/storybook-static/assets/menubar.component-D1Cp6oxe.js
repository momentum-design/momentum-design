import{i as g,k as E}from"./lit-element-D5KKan5q.js";import{n as x,C as M}from"./index-C9z9WAEj.js";import{o as R}from"./query-assigned-elements-uEuc3rg8.js";import{O as o,T as N}from"./menubar.constants-Cq-jpWsM.js";import{T}from"./menupopover.constants-C3xzY-3O.js";import{T as C}from"./menusection.constants-CectB7Mc.js";import{T as V,K as r}from"./listitem.component-18vOGq9d.js";import{P as b}from"./popover.component-D_fkT_SB.js";import{R as p}from"./roles-BH_hBfTz.js";var L=Object.defineProperty,P=(d,h,I,e)=>{for(var t=void 0,s=d.length-1,i;s>=0;s--)(i=d[s])&&(t=i(h,I,t)||t);return t&&L(h,I,t),t};const y=d=>{class h extends d{constructor(){super(...arguments),this.ariaOrientation=o.HORIZONTAL}get menuItems(){var s;const e=(s=this.shadowRoot)==null?void 0:s.querySelector("slot");return((e==null?void 0:e.assignedElements({flatten:!0}))||[]).map(i=>i.tagName.toLowerCase()===C?Array.from(i.children).filter(n=>this.isValidMenuItem(n)):this.isValidMenuItem(i)?i:[]).flat().filter(i=>!!i).filter(i=>!i.hasAttribute("disabled"))}firstUpdated(e){super.firstUpdated(e),this.setMenuBarPopoverValue(!1),this.resetTabIndexAndSetActiveTabIndex(this.menuItems)}setMenuBarPopoverValue(e){const{menu:t}=this.getParentMenuItemDetails("",this);t==null||t.setAttribute("data-menu-popover-open",e.toString())}isMenuPopoverOpen(){const{menu:e}=this.getParentMenuItemDetails("",this);return(e==null?void 0:e.getAttribute("data-menu-popover-open"))==="true"}getCurrentIndex(e){return this.menuItems.findIndex(t=>t===e||t===e.parentElement)}updatePopoverPlacementBasedOnOrientation(){this.ariaOrientation===o.HORIZONTAL?this.menuPopoverItems.forEach(e=>{e.setAttribute("placement",b.BOTTOM_START)}):this.menuPopoverItems.forEach(e=>{e.setAttribute("placement",b.RIGHT_START)})}updateTabIndexAndFocusNewIndex(e,t,s){var i,n,a,l;if(!(s<0||t<0)){if(t===s){(i=e[t])==null||i.focus();return}(n=e[t])==null||n.setAttribute("tabindex","-1"),(a=e[s])==null||a.setAttribute("tabindex","0"),(l=e[s])==null||l.focus()}}isValidMenu(e){return(e==null?void 0:e.toLowerCase())===N||this.isValidNavItemList(e)}isValidNavItemList(e){return(e==null?void 0:e.toLowerCase())===V}isValidPopover(e){return(e==null?void 0:e.toLowerCase())===T}openPopover(e){var t,s;if(this.isValidPopover((s=(t=this.menuItems[e])==null?void 0:t.nextElementSibling)==null?void 0:s.tagName)){const i=this.menuItems[e].getAttribute("id"),n=this.menuPopoverItems.findIndex(a=>a.getAttribute("triggerid")===i);if(n!==-1)return this.menuPopoverItems[n].hasAttribute("visible")||this.menuPopoverItems[n].toggleAttribute("visible"),this.setMenuBarPopoverValue(!0),!0}return!1}navigateToPrevMenuItem(e,t,s,i){const n=e===t?s:e-1;this.updateTabIndexAndFocusNewIndex(this.menuItems,e,n),this.isMenuPopoverOpen()&&i===o.HORIZONTAL&&this.openPopover(n)}navigateToNextMenuItem(e,t,s,i){const n=e===s?t:e+1;this.updateTabIndexAndFocusNewIndex(this.menuItems,e,n),this.isMenuPopoverOpen()&&i===o.HORIZONTAL&&this.openPopover(n)}getParentMenuItemDetails(e,t){var s;return t===null?{menu:null,menuChildId:e}:t&&this.isValidMenu(t.tagName)?{menu:t,menuChildId:e}:this.getParentMenuItemDetails(((s=t==null?void 0:t.previousElementSibling)==null?void 0:s.getAttribute("id"))??"",t==null?void 0:t.parentElement)}hideAllPopovers(e){if(!this.isValidMenu(e==null?void 0:e.tagName)){if(this.isValidPopover(e==null?void 0:e.tagName)&&(e==null||e.toggleAttribute("visible")),e!=null&&e.children){const t=Array.from(e.children).filter(s=>this.isValidMenuItem(s));this.resetTabIndexAndSetActiveTabIndex(t)}e!=null&&e.parentElement&&this.hideAllPopovers(e.parentElement)}}navigateToPrevParentMenuItem(e,t){var l,u,A,m,v;const s=(l=this.menuItems[e].parentElement)==null?void 0:l.previousElementSibling,i=Array.from(((u=this.parentElement)==null?void 0:u.children)||[]).filter(c=>this.isValidMenuItem(c)),n=i.findIndex(c=>c===s);let a=n;t===r.ARROW_LEFT&&this.isValidMenu((A=this.parentElement)==null?void 0:A.tagName)&&(a=n-1),this.updateTabIndexAndFocusNewIndex(i,n,a),(v=(m=i[n-1])==null?void 0:m.nextElementSibling)==null||v.toggleAttribute("visible")}closePopoverAndNavigateToPrevParentMenuItem(e,t){this.toggleAttribute("visible"),this.navigateToPrevParentMenuItem(e,t)}getParentMenuContents(e){var i;const t=this.getParentMenuItemDetails("",e),s=Array.from(((i=t.menu)==null?void 0:i.children)||[]).filter(n=>this.isValidMenuItem(n));return{parentMenuItemDetails:t,parentMenuItemsChildren:s}}openPopoverAndNavigateToNextChildrenMenuItem(e){var a,l;if(this.openPopover(e)||(this.hideAllPopovers(this.menuItems[e]),this.isValidMenu(this.tagName)))return;const{parentMenuItemDetails:t,parentMenuItemsChildren:s}=this.getParentMenuContents(this.menuItems[e]);if(s.length===0||(t==null?void 0:t.menuChildId)===""){this.navigateToNextMenuItem(e,0,this.menuItems.length-1,this.ariaOrientation);return}const i=s.findIndex(u=>u.getAttribute("id")===(t==null?void 0:t.menuChildId)),n=i===-1?e+1:i+1;this.updateTabIndexAndFocusNewIndex(s,i,n),(l=(a=s[n])==null?void 0:a.nextElementSibling)==null||l.toggleAttribute("visible")}isValidMenuItem(e){const t=[p.MENUITEM,p.MENUITEMCHECKBOX,p.MENUITEMRADIO],s=e.getAttribute("role");return s!==null&&t.includes(s)}resetTabIndexAndSetActiveTabIndex(e){e.forEach((t,s)=>{const i=s===0?"0":"-1";t==null||t.setAttribute("tabindex",i)})}getKeyBasedOnDirection(e){var i;let t=e;return(((i=document.querySelector("html"))==null?void 0:i.getAttribute("dir"))==="rtl"||window.getComputedStyle(this).direction==="rtl")&&(t===r.ARROW_LEFT||t===r.ARROW_RIGHT)&&(t===r.ARROW_LEFT?t=r.ARROW_RIGHT:t=r.ARROW_LEFT),t}handleKeyDown(e){var a,l;const s=this.menuItems.length-1,i=this.getCurrentIndex(e.target);if(i===-1)return;switch(this.getKeyBasedOnDirection(e.key)){case r.HOME:this.updateTabIndexAndFocusNewIndex(this.menuItems,i,0);break;case r.END:this.updateTabIndexAndFocusNewIndex(this.menuItems,i,s);break;case r.ARROW_LEFT:{this.ariaOrientation===o.HORIZONTAL&&this.navigateToPrevMenuItem(i,0,s,this.ariaOrientation),this.ariaOrientation===o.VERTICAL&&this.closePopoverAndNavigateToPrevParentMenuItem(i,e.key);break}case r.ARROW_RIGHT:{this.ariaOrientation===o.HORIZONTAL&&this.navigateToNextMenuItem(i,0,s,this.ariaOrientation),this.ariaOrientation===o.VERTICAL&&this.openPopoverAndNavigateToNextChildrenMenuItem(i);break}case r.ARROW_UP:{this.ariaOrientation===o.HORIZONTAL&&this.openPopover(i),this.ariaOrientation===o.VERTICAL&&this.navigateToPrevMenuItem(i,0,s,this.ariaOrientation),e.preventDefault();break}case r.ARROW_DOWN:{this.ariaOrientation===o.HORIZONTAL&&this.openPopover(i),this.ariaOrientation===o.VERTICAL&&this.navigateToNextMenuItem(i,0,s,this.ariaOrientation),e.preventDefault();break}case r.SPACE:case r.ENTER:{this.isValidPopover((l=(a=this.menuItems[i])==null?void 0:a.nextElementSibling)==null?void 0:l.tagName)?this.openPopoverAndNavigateToNextChildrenMenuItem(i):this.isValidMenuItem(e.target)&&this.setMenuBarPopoverValue(!1);break}case r.ESCAPE:{this.setMenuBarPopoverValue(!1);break}}}closeAllPopoversExceptCurrent(e){this.menuPopoverItems.filter(t=>t!==this.menuItems[e]).filter(t=>t.hasAttribute("visible")).forEach(t=>t.toggleAttribute("visible"))}handleMouseClick(e){var i;const t=e.target,s=this.getCurrentIndex(t);s!==-1&&(this.isValidPopover((i=t==null?void 0:t.nextElementSibling)==null?void 0:i.tagName)?(this.closeAllPopoversExceptCurrent(s),this.openPopoverAndNavigateToNextChildrenMenuItem(s)):this.isValidMenuItem(t)&&t.parentElement.hidePopover())}}return P([x({type:String,reflect:!0,attribute:"aria-orientation"})],h.prototype,"ariaOrientation"),P([R({selector:`${T}:not([disabled])`})],h.prototype,"menuPopoverItems"),h},k=g`
  :host {
    display: flex;
  }

  :host([aria-orientation='horizontal']) {
    flex-direction: row;
  }

  :host([aria-orientation='vertical']) {
    flex-direction: column;
  }
`,w=[k],f=class f extends y(M){constructor(){super(),this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("click",this.handleMouseClick)}connectedCallback(){super.connectedCallback(),this.role=p.MENUBAR}update(h){super.update(h),h.has("ariaOrientation")&&this.updatePopoverPlacementBasedOnOrientation()}render(){return E`<slot></slot>`}};f.styles=[...M.styles,...w];let O=f;export{O as M,y as a};
