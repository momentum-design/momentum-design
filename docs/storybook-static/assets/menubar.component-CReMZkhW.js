import{i as g,k as E}from"./lit-element-D5KKan5q.js";import{u as x,n as R,C as m}from"./index-C9z9WAEj.js";import{o as C}from"./query-assigned-elements-uEuc3rg8.js";import{T as N}from"./menu.constants-Bt64zAlX.js";import{T}from"./menupopover.constants-D31hJpJi.js";import{T as V}from"./menusection.constants-CectB7Mc.js";import{b as L,K as r}from"./listitem.component-Db47CIxY.js";import{P as b}from"./popover.component-B9J0JIz9.js";import{R as O}from"./roles-Ch6n0tol.js";const y=x.constructTagName("menubar"),a={HORIZONTAL:"horizontal",VERTICAL:"vertical"};var w=Object.defineProperty,M=(u,h,p,e)=>{for(var t=void 0,s=u.length-1,i;s>=0;s--)(i=u[s])&&(t=i(h,p,t)||t);return t&&w(h,p,t),t};const k=u=>{class h extends u{constructor(){super(...arguments),this.ariaOrientation=a.HORIZONTAL}get menuItems(){var s;const e=(s=this.shadowRoot)==null?void 0:s.querySelector("slot");return((e==null?void 0:e.assignedElements({flatten:!0}))||[]).map(i=>i.tagName.toLowerCase()===V?Array.from(i.children).filter(n=>this.isValidMenuItem(n)):this.isValidMenuItem(i)?i:[]).flat().filter(i=>!!i).filter(i=>!i.hasAttribute("disabled"))}firstUpdated(e){super.firstUpdated(e),this.setMenuBarPopoverValue(!1),this.resetTabIndexAndSetActiveTabIndex(this.menuItems)}setMenuBarPopoverValue(e){const{menu:t}=this.getParentMenuItemDetails("",this);t==null||t.setAttribute("data-menu-popover-open",e.toString())}isMenuPopoverOpen(){const{menu:e}=this.getParentMenuItemDetails("",this);return(e==null?void 0:e.getAttribute("data-menu-popover-open"))==="true"}getCurrentIndex(e){return this.menuItems.findIndex(t=>t===e||t===e.parentElement)}updatePopoverPlacementBasedOnOrientation(){this.ariaOrientation===a.HORIZONTAL?this.menuPopoverItems.forEach(e=>{e.setAttribute("placement",b.BOTTOM_START)}):this.menuPopoverItems.forEach(e=>{e.setAttribute("placement",b.RIGHT_START)})}updateTabIndexAndFocusNewIndex(e,t,s){var i,n,o,l;if(!(s<0||t<0)){if(t===s){(i=e[t])==null||i.focus();return}(n=e[t])==null||n.setAttribute("tabindex","-1"),(o=e[s])==null||o.setAttribute("tabindex","0"),(l=e[s])==null||l.focus()}}isValidMenu(e){return(e==null?void 0:e.toLowerCase())===N||(e==null?void 0:e.toLowerCase())===y||this.isValidNavItemList(e)}isValidNavItemList(e){return(e==null?void 0:e.toLowerCase())===L}isValidPopover(e){return(e==null?void 0:e.toLowerCase())===T}openPopover(e){var t,s;if(this.isValidPopover((s=(t=this.menuItems[e])==null?void 0:t.nextElementSibling)==null?void 0:s.tagName)){const i=this.menuItems[e].getAttribute("id"),n=this.menuPopoverItems.findIndex(o=>o.getAttribute("triggerid")===i);if(n!==-1)return this.menuPopoverItems[n].hasAttribute("visible")||this.menuPopoverItems[n].toggleAttribute("visible"),this.setMenuBarPopoverValue(!0),!0}return!1}navigateToPrevMenuItem(e,t,s,i){const n=e===t?s:e-1;this.updateTabIndexAndFocusNewIndex(this.menuItems,e,n),this.isMenuPopoverOpen()&&i===a.HORIZONTAL&&this.openPopover(n)}navigateToNextMenuItem(e,t,s,i){const n=e===s?t:e+1;this.updateTabIndexAndFocusNewIndex(this.menuItems,e,n),this.isMenuPopoverOpen()&&i===a.HORIZONTAL&&this.openPopover(n)}getParentMenuItemDetails(e,t){var s;return t===null?{menu:null,menuChildId:e}:t&&this.isValidMenu(t.tagName)?{menu:t,menuChildId:e}:this.getParentMenuItemDetails(((s=t==null?void 0:t.previousElementSibling)==null?void 0:s.getAttribute("id"))??"",t==null?void 0:t.parentElement)}hideAllPopovers(e){if(!this.isValidMenu(e==null?void 0:e.tagName)){if(this.isValidPopover(e==null?void 0:e.tagName)&&(e==null||e.toggleAttribute("visible")),e!=null&&e.children){const t=Array.from(e.children).filter(s=>this.isValidMenuItem(s));this.resetTabIndexAndSetActiveTabIndex(t)}e!=null&&e.parentElement&&this.hideAllPopovers(e.parentElement)}}navigateToPrevParentMenuItem(e,t){var l,d,A,f,v;const s=(l=this.menuItems[e].parentElement)==null?void 0:l.previousElementSibling,i=Array.from(((d=this.parentElement)==null?void 0:d.children)||[]).filter(I=>this.isValidMenuItem(I)),n=i.findIndex(I=>I===s);let o=n;t===r.ARROW_LEFT&&this.isValidMenu((A=this.parentElement)==null?void 0:A.tagName)&&(o=n-1),this.updateTabIndexAndFocusNewIndex(i,n,o),(v=(f=i[n-1])==null?void 0:f.nextElementSibling)==null||v.toggleAttribute("visible")}closePopoverAndNavigateToPrevParentMenuItem(e,t){this.toggleAttribute("visible"),this.navigateToPrevParentMenuItem(e,t)}getParentMenuContents(e){var i;const t=this.getParentMenuItemDetails("",e),s=Array.from(((i=t.menu)==null?void 0:i.children)||[]).filter(n=>this.isValidMenuItem(n));return{parentMenuItemDetails:t,parentMenuItemsChildren:s}}openPopoverAndNavigateToNextChildrenMenuItem(e){var o,l;if(this.openPopover(e)||(this.hideAllPopovers(this.menuItems[e]),this.isValidMenu(this.tagName)))return;const{parentMenuItemDetails:t,parentMenuItemsChildren:s}=this.getParentMenuContents(this.menuItems[e]);if(s.length===0||(t==null?void 0:t.menuChildId)===""){this.navigateToNextMenuItem(e,0,this.menuItems.length-1,this.ariaOrientation);return}const i=s.findIndex(d=>d.getAttribute("id")===(t==null?void 0:t.menuChildId)),n=i===-1?e+1:i+1;this.updateTabIndexAndFocusNewIndex(s,i,n),(l=(o=s[n])==null?void 0:o.nextElementSibling)==null||l.toggleAttribute("visible")}isValidMenuItem(e){return e.getAttribute("role")===O.MENUITEM}resetTabIndexAndSetActiveTabIndex(e){e.forEach((t,s)=>{const i=s===0?"0":"-1";t==null||t.setAttribute("tabindex",i)})}getKeyBasedOnDirection(e){var i;let t=e;return(((i=document.querySelector("html"))==null?void 0:i.getAttribute("dir"))==="rtl"||window.getComputedStyle(this).direction==="rtl")&&(t===r.ARROW_LEFT||t===r.ARROW_RIGHT)&&(t===r.ARROW_LEFT?t=r.ARROW_RIGHT:t=r.ARROW_LEFT),t}handleKeyDown(e){var o,l;const s=this.menuItems.length-1,i=this.getCurrentIndex(e.target);if(i===-1)return;switch(this.getKeyBasedOnDirection(e.key)){case r.HOME:this.updateTabIndexAndFocusNewIndex(this.menuItems,i,0);break;case r.END:this.updateTabIndexAndFocusNewIndex(this.menuItems,i,s);break;case r.ARROW_LEFT:{this.ariaOrientation===a.HORIZONTAL&&this.navigateToPrevMenuItem(i,0,s,this.ariaOrientation),this.ariaOrientation===a.VERTICAL&&this.closePopoverAndNavigateToPrevParentMenuItem(i,e.key);break}case r.ARROW_RIGHT:{this.ariaOrientation===a.HORIZONTAL&&this.navigateToNextMenuItem(i,0,s,this.ariaOrientation),this.ariaOrientation===a.VERTICAL&&this.openPopoverAndNavigateToNextChildrenMenuItem(i);break}case r.ARROW_UP:{this.ariaOrientation===a.HORIZONTAL&&this.openPopover(i),this.ariaOrientation===a.VERTICAL&&this.navigateToPrevMenuItem(i,0,s,this.ariaOrientation),e.preventDefault();break}case r.ARROW_DOWN:{this.ariaOrientation===a.HORIZONTAL&&this.openPopover(i),this.ariaOrientation===a.VERTICAL&&this.navigateToNextMenuItem(i,0,s,this.ariaOrientation),e.preventDefault();break}case r.SPACE:case r.ENTER:{this.isValidPopover((l=(o=this.menuItems[i])==null?void 0:o.nextElementSibling)==null?void 0:l.tagName)?this.openPopoverAndNavigateToNextChildrenMenuItem(i):this.isValidMenuItem(e.target)&&this.setMenuBarPopoverValue(!1);break}case r.ESCAPE:{this.setMenuBarPopoverValue(!1);break}}}closeAllPopoversExceptCurrent(e){this.menuPopoverItems.filter(t=>t!==this.menuItems[e]).filter(t=>t.hasAttribute("visible")).forEach(t=>t.toggleAttribute("visible"))}handleMouseClick(e){var i;const t=e.target,s=this.getCurrentIndex(t);s!==-1&&(this.isValidPopover((i=t==null?void 0:t.nextElementSibling)==null?void 0:i.tagName)?(this.closeAllPopoversExceptCurrent(s),this.openPopoverAndNavigateToNextChildrenMenuItem(s)):this.isValidMenuItem(t)&&t.parentElement.hidePopover())}}return M([R({type:String,reflect:!0,attribute:"aria-orientation"})],h.prototype,"ariaOrientation"),M([C({selector:`${T}:not([disabled])`})],h.prototype,"menuPopoverItems"),h},_=g`
  :host {
    display: flex;
  }

  :host([aria-orientation='horizontal']) {
    flex-direction: row;
  }

  :host([aria-orientation='vertical']) {
    flex-direction: column;
  }
`,S=[_],c=class c extends k(m){constructor(){super(),this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("click",this.handleMouseClick)}connectedCallback(){super.connectedCallback(),this.role=O.MENUBAR}update(h){super.update(h),h.has("ariaOrientation")&&this.updatePopoverPlacementBasedOnOrientation()}render(){return E`<slot></slot>`}};c.styles=[...m.styles,...S];let P=c;export{P as M,a as O,y as T,k as a};
