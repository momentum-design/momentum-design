import{n as I}from"./index-C9z9WAEj.js";import{K as i}from"./listitem.component-DDDLhHxU.js";import{R as c}from"./roles-BH_hBfTz.js";import{T as k,a as O}from"./menuitemradio.constants-BhdhQZcn.js";import{T as A}from"./menuitem.component-fYeQJXIJ.js";import{T as M}from"./menuitemcheckbox.constants-DmrkQGAP.js";import{a as E,p as l,C as R}from"./popover.component-q7gOo8Yi.js";import{T as h,D as T}from"./menupopover.constants-BkwERfSm.js";import{i as C}from"./lit-element-D5KKan5q.js";const v=C`
  :host::part(popover-content) {
    padding: 0.75rem 0.5rem;
  }

  ::slotted(mdc-divider) {
    margin-block: 0.25rem;
  }
`,y=[v],p=n=>{var t;if(!n)return!1;const e=(t=n.getAttribute("role"))==null?void 0:t.toLowerCase();return e===c.MENUITEM||e===c.MENUITEMCHECKBOX||e===c.MENUITEMRADIO},P=n=>{var e;return((e=n==null?void 0:n.tagName)==null?void 0:e.toLowerCase())===h};var S=Object.defineProperty,N=(n,e,t,r)=>{for(var s=void 0,o=n.length-1,d;o>=0;o--)(d=n[o])&&(s=d(e,t,s)||s);return s&&S(e,t,s),s};const m=class m extends E{constructor(){super(),this.placement=T.PLACEMENT,this.menuItems=[],this.onOutsidePopoverClick=e=>{if(l.peek()!==this)return;const t=this.findClosestPopover(e.target);if(t&&l.has(t)){this.closeAllMenuPopovers(t);return}const r=e.composedPath(),s=this.contains(e.target)||r.includes(this.triggerElement),o=this.backdropElement?r.includes(this.backdropElement):!1;(!s||o)&&this.closeAllMenuPopovers()},this.togglePopoverVisible=()=>{var e;(e=this.triggerElement)!=null&&e.hasAttribute("soft-disabled")||(this.isTriggerClicked?this.hidePopover():(this.showPopover(),this.isTriggerClicked=!0))},this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("keyup",this.handleKeyUp),this.addEventListener("click",this.handleMouseClick)}collectMenuItems(){var r;const e=(r=this.shadowRoot)==null?void 0:r.querySelector("slot"),t=(e==null?void 0:e.assignedElements({flatten:!0}))||[];this.menuItems=t.map(s=>s.tagName.toLowerCase()===k?Array.from(s.children).filter(o=>p(o)):p(s)?s:[]).flat().filter(s=>!!s&&!s.hasAttribute("disabled"))}connectedCallback(){super.connectedCallback(),this.role=c.MENU,this.ariaOrientation=T.ORIENTATION,this.backdrop=!1,this.color=R.TONAL,this.disableAriaExpanded=!1,this.focusBackToTrigger=!0,this.focusTrap=!0,this.hideOnEscape=!0,this.hideOnOutsideClick=!0,this.interactive=!0,this.showArrow=!1,this.closeButton=!1,this.closeButtonAriaLabel=null}async isOpenUpdated(e,t){return e===t||!this.triggerElement?Promise.resolve():(t&&(this.backdrop=this.triggerElement.tagName.toLowerCase()!==A),super.isOpenUpdated(e,t))}async firstUpdated(e){var t;await super.firstUpdated(e),this.collectMenuItems(),this.resetTabIndexes(0),(t=this.triggerElement)==null||t.setAttribute("aria-haspopup",c.MENU)}resetTabIndexes(e){this.menuItems.length>0&&(this.menuItems.forEach(t=>t.setAttribute("tabindex","-1")),this.menuItems[e].setAttribute("tabindex","0"))}getCurrentIndex(e){return this.menuItems.findIndex(t=>t===e)}resetTabIndexAndSetFocus(e,t){e!==t&&(this.menuItems[t].setAttribute("tabindex","-1"),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}closeAllMenuPopovers(e){for(;l.peek()!==e;){const t=l.pop();if(t)t.hidePopover();else break}}hasSubmenuWithTriggerId(e){var t,r;return!!e&&((r=(t=this.parentElement)==null?void 0:t.querySelector)==null?void 0:r.call(t,`${h}[triggerid="${e}"]`))!==null}closeMenu(e){const t=e.getAttribute("id");p(e)&&!this.hasSubmenuWithTriggerId(t)&&this===e.closest(h)&&(this.closeAllMenuPopovers(),e.matches(A)&&e.dispatchEvent(new Event("action",{bubbles:!0,composed:!0})))}handleMouseClick(e){const t=e.target;e.isTrusted&&this.closeMenu(t)}resolveDirectionKey(e,t){if(!t)return e;switch(e){case i.ARROW_LEFT:return i.ARROW_RIGHT;case i.ARROW_RIGHT:return i.ARROW_LEFT;default:return e}}handleKeyDown(e){var f,g;let t=!1;this.collectMenuItems();const r=e.target,s=this.getCurrentIndex(r);if(s===-1)return;this.resetTabIndexes(s);const o=window.getComputedStyle(this).direction==="rtl";switch(this.resolveDirectionKey(e.key,o)){case i.HOME:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case i.END:{this.resetTabIndexAndSetFocus(this.menuItems.length-1,s),t=!0;break}case i.ARROW_DOWN:{const a=s+1===this.menuItems.length?0:s+1;this.resetTabIndexAndSetFocus(a,s),t=!0;break}case i.ARROW_UP:{const a=s-1===-1?this.menuItems.length-1:s-1;this.resetTabIndexAndSetFocus(a,s),t=!0;break}case i.ARROW_RIGHT:{const a=(f=this.menuItems[s])==null?void 0:f.getAttribute("id");if(this.hasSubmenuWithTriggerId(a)){const b=(g=this.parentElement)==null?void 0:g.querySelector(`${h}[triggerid="${a}"]`);b&&(b.showPopover(),t=!0)}break}case i.ARROW_LEFT:{P(this.parentElement)&&(this.hidePopover(),this.resetTabIndexAndSetFocus(0,s),t=!0);break}case i.ESCAPE:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case i.ENTER:{this.closeMenu(r),t=!0;break}case i.SPACE:{t=!0;break}}t&&(e.stopPropagation(),e.preventDefault())}handleKeyUp(e){let t=!1;const r=e.target;switch(e.key){case i.SPACE:{r.matches(`${O}, ${M}`)||(this.closeMenu(r),t=!0);break}}t&&(e.stopPropagation(),e.preventDefault())}};m.styles=[...E.styles,...y];let u=m;N([I({type:String,reflect:!0})],u.prototype,"placement");u.register(h);
