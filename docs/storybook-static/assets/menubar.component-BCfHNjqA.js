import{i as f,k as g}from"./lit-element-D5KKan5q.js";import{o as b}from"./query-assigned-elements-uEuc3rg8.js";import{u as A,C as l}from"./index-C9z9WAEj.js";import{R as p}from"./roles-BH_hBfTz.js";import{p as I,P as T}from"./popover.component-Bw5zQP8M.js";import{T as o}from"./menupopover.constants-Df21F9dQ.js";import{T as u}from"./menuitem.component-BoKm6qLY.js";import{K as a}from"./listitem.component-Bh3_BYs0.js";const R=A.constructTagName("menubar"),v={ORIENTATION:"vertical"},M=f`
  :host {
    display: flex;
  }

  :host([aria-orientation='horizontal']) {
    flex-direction: row;
  }

  :host([aria-orientation='vertical']) {
    flex-direction: column;
  }
`,x=[M];var E=Object.defineProperty,O=(d,t,e,i)=>{for(var s=void 0,n=d.length-1,r;n>=0;n--)(r=d[n])&&(s=r(t,e,s)||s);return s&&E(t,e,s),s};const h=class h extends l{constructor(){super(),this.addEventListener("keydown",this.handleKeyDown)}connectedCallback(){super.connectedCallback(),this.role=p.MENUBAR,this.ariaOrientation=v.ORIENTATION}update(t){super.update(t),this.updatePopoverPlacement()}firstUpdated(t){super.firstUpdated(t),this.resetTabIndexAndSetActiveTabIndex(this.menuItems)}resetTabIndexAndSetActiveTabIndex(t){t.forEach((e,i)=>{const s=i===0?"0":"-1";e==null||e.setAttribute("tabindex",s)})}getCurrentIndex(t){return this.menuItems.findIndex(e=>e===t||e===t.parentElement)}updatePopoverPlacement(){const t=this.querySelectorAll(`${o}:not([disabled])`),e=T.RIGHT_START;t.forEach(i=>i.setAttribute("placement",e))}updateTabIndexAndFocus(t,e,i){var s,n,r;i<0||e<0||(e!==i&&((s=t[e])==null||s.setAttribute("tabindex","-1"),(n=t[i])==null||n.setAttribute("tabindex","0")),(r=t[i])==null||r.focus())}navigateToMenuItem(t,e,i=!1){var r;const{length:s}=this.menuItems;if(s===0)return;let n=t;if(e==="prev"?n=(t-1+s)%s:n=(t+1)%s,this.updateTabIndexAndFocus(this.menuItems,t,n),i){const c=(r=this.menuItems[n])==null?void 0:r.getAttribute("id");this.hasSubmenu(c)&&!this.menuItems[n].hasAttribute("soft-disabled")&&this.showSubmenu(c)}}showSubmenu(t){const e=this.querySelector(`${o}[triggerid="${t}"]`);e==null||e.showPopover()}getKeyWithDirectionFix(t){return window.getComputedStyle(this).direction==="rtl"?t===a.ARROW_LEFT?a.ARROW_RIGHT:t===a.ARROW_RIGHT?a.ARROW_LEFT:t:t}isTopLevelMenuItem(t){var e;return((e=t.parentElement)==null?void 0:e.tagName.toLowerCase())===R&&t.tagName.toLowerCase()===u}isNestedMenuItem(t){return!!t.closest(o)&&t.tagName.toLowerCase()===u}async closeAllMenuPopovers(){const t=[];for(;I.peek();){const e=I.pop();e&&(e.hidePopover(),t.push(e))}await Promise.all(t.map(e=>e.updateComplete))}async crossMenubarNavigationOnLeft(t){if(t.tagName.toLowerCase()===u){const i=t.closest(o),s=i==null?void 0:i.getAttribute("triggerid"),n=this.menuItems.find(r=>r.getAttribute("id")===s);if(n){this.isTopLevelMenuItem(n)&&(i==null||i.hidePopover()),await(i==null?void 0:i.updateComplete);const r=this.getCurrentIndex(n);this.navigateToMenuItem(r,"prev",!0)}}}async crossMenubarNavigationOnRight(t){if(this.isTopLevelMenuItem(t)&&this.hasSubmenu(t.id)&&!t.hasAttribute("soft-disabled"))this.showSubmenu(t.id);else if(this.isNestedMenuItem(t)&&!this.hasSubmenu(t.id)){await this.closeAllMenuPopovers();const e=this.getParentMenuItemIndex(t);e>=0&&this.navigateToMenuItem(e,"next",!0)}}hasSubmenu(t){return!!this.querySelector(`${o}[triggerid="${t}"]`)}getParentMenuItemIndex(t){let e=t.parentElement;for(;e;){if(e.tagName.toLowerCase()===o){const i=e.getAttribute("triggerid"),s=this.menuItems.find(n=>n.getAttribute("id")===i);if(s)return this.isTopLevelMenuItem(s)?this.menuItems.findIndex(n=>n===s):this.getParentMenuItemIndex(s)}e=e.parentElement}return-1}async handleKeyDown(t){const e=this.getCurrentIndex(t.target);switch(this.getKeyWithDirectionFix(t.key)){case a.HOME:this.updateTabIndexAndFocus(this.menuItems,e,0);break;case a.END:this.updateTabIndexAndFocus(this.menuItems,e,this.menuItems.length-1);break;case a.ARROW_LEFT:{const s=e>=0?this.menuItems[e]:t.target;await this.crossMenubarNavigationOnLeft(s);break}case a.ARROW_RIGHT:{const s=e>=0?this.menuItems[e]:t.target;await this.crossMenubarNavigationOnRight(s);break}case a.ARROW_UP:{this.navigateToMenuItem(e,"prev"),t.preventDefault();break}case a.ARROW_DOWN:{this.navigateToMenuItem(e,"next"),t.preventDefault();break}}}render(){return g`<slot role="${p.GROUP}"></slot>`}};h.styles=[...l.styles,...x];let m=h;O([b({selector:`${u}:not([disabled])`})],m.prototype,"menuItems");export{m as M,R as T};
