import{X as g,R as u,n as I}from"./iframe-BStS_Y8s.js";import{a as E,T as M}from"./menuitemradio.constants-C5MNOnwv.js";import{b as c,d as m,c as A}from"./menupopover.constants-BcIZ4KM9.js";import{T as f}from"./menuitem.component-C9mwSUWS.js";import{T}from"./menuitemcheckbox.constants-BtmlOF3i.js";import{P as b}from"./popover.component-CYDMN8yQ.js";import{C as O}from"./popover.constants-CEz44EE7.js";import{A as r}from"./KeyToActionMixin-DDHGwyRi.js";const v=g`
  :host::part(popover-content) {
    padding: 0.75rem 0.5rem;
  }

  ::slotted(mdc-divider) {
    margin-block: 0.25rem;
  }
`,S=[v],h=n=>{var t;if(!n)return!1;const e=(t=n.getAttribute("role"))==null?void 0:t.toLowerCase();return e===u.MENUITEM||e===u.MENUITEMCHECKBOX||e===u.MENUITEMRADIO},p=n=>{var e;return((e=n==null?void 0:n.tagName)==null?void 0:e.toLowerCase())===c};var P=Object.defineProperty,C=(n,e,t,i)=>{for(var s=void 0,o=n.length-1,a;o>=0;o--)(a=n[o])&&(s=a(e,t,s)||s);return s&&P(e,t,s),s};const l=class l extends b{constructor(){super(),this.placement=m.PLACEMENT,this.menuItems=[],this.menuItemsWithSubMenus=[],this.onOutsidePopoverClick=e=>{if(!this.depthManager.isHostOnTop())return;const t=e.composedPath(),i=this.contains(e.target)||t.includes(this.triggerElement)||t.includes(this),s=this.backdropElement?t.includes(this.backdropElement):!1;(!i||s)&&this.closeAllMenuPopovers()},this.togglePopoverVisible=e=>{var t;(t=this.triggerElement)!=null&&t.hasAttribute("soft-disabled")||(e.composedPath().find(i=>i.tagName===this.tagName)===this&&this.handleMouseClick(e),this.isEventFromTrigger(e)&&(this.visible?this.hide():this.show()))},this.handleItemCreation=e=>{const t=e.target;h(t)&&(e.stopImmediatePropagation(),t.addEventListener("destroyed",this.handleItemChangeEvent),t.addEventListener("disabled",this.handleItemChangeEvent))},this.handleItemChangeEvent=e=>{e.stopImmediatePropagation(),e.target&&e.type==="destroyed"&&(e.target.removeEventListener("destroyed",this.handleItemChangeEvent),e.target.removeEventListener("disabled",this.handleItemChangeEvent)),this.resetMenuNavigation()},this.resetMenuNavigation=()=>{this.collectMenuItems(),this.menuItems.find(t=>t.getAttribute("tabindex")==="0")||this.resetTabIndexes(0)},this.handleKeyDown=e=>{let t=!1;this.collectMenuItems();const i=e.target,s=this.getCurrentIndex(i);if(s===-1)return;switch(this.resetTabIndexes(s),this.getActionForKeyEvent(e,!0)){case r.HOME:{this.resetTabIndexAndSetFocus(0,s),t=!0;break}case r.END:{this.resetTabIndexAndSetFocus(this.menuItems.length-1,s),t=!0;break}case r.DOWN:{const a=s+1===this.menuItems.length?0:s+1;this.resetTabIndexAndSetFocus(a,s),t=!0;break}case r.UP:{const a=s-1===-1?this.menuItems.length-1:s-1;this.resetTabIndexAndSetFocus(a,s),t=!0;break}case r.RIGHT:{const a=this.getSubMenuPopoverOfTarget(i);a&&(a.show(),t=!0);break}case r.LEFT:{p(this.parentElement)&&(this.hide(),this.resetTabIndexAndSetFocus(0,s),t=!0);break}case r.ESCAPE:{this.depthManager.isHostOnTop()&&(this.resetTabIndexAndSetFocus(0,s),t=!0);break}case r.ENTER:{!this.getSubMenuPopoverOfTarget(i)&&!i.hasAttribute("soft-disabled")&&(this.closeAllMenuPopovers(),this.fireMenuItemAction(i),t=!0);break}case r.SPACE:{t=!0;break}}t&&(e.stopPropagation(),e.preventDefault())},this.handleKeyUp=e=>{let t=!1;const i=e.target;switch(this.getActionForKeyEvent(e)){case r.SPACE:{!i.matches(`${E}, ${T}`)&&!i.hasAttribute("soft-disabled")&&(this.getSubMenuPopoverOfTarget(i)||(this.closeAllMenuPopovers(),this.fireMenuItemAction(i),t=!0));break}}t&&(e.stopPropagation(),e.preventDefault())},this.addEventListener("keydown",this.handleKeyDown),this.addEventListener("keyup",this.handleKeyUp),this.addEventListener("created",this.handleItemCreation)}getSubMenuPopoverOfTarget(e){var i,s;const t=e.getAttribute("id");return t?(s=(i=this.parentElement)==null?void 0:i.querySelector)==null?void 0:s.call(i,`${c}[triggerid="${t}"]`):null}collectMenuItems(){var i;const e=(i=this.shadowRoot)==null?void 0:i.querySelector("slot"),t=(e==null?void 0:e.assignedElements({flatten:!0}))||[];this.menuItems=t.map(s=>s.tagName.toLowerCase()===M?Array.from(s.children).filter(o=>h(o)):h(s)?s:[]).flat().filter(s=>!!s&&!s.hasAttribute("disabled")),this.menuItemsWithSubMenus=this.menuItems.filter(s=>this.getSubMenuPopoverOfTarget(s))}getOpenSubMenusOfItems(e){const t=[];return!e||e.length===0||e.forEach(i=>{const s=this.getSubMenuPopoverOfTarget(i);s&&s.visible&&t.push(s)}),t}connectedCallback(){super.connectedCallback(),this.role=u.MENU,this.ariaOrientation=m.ORIENTATION,this.backdrop=!1,this.color=O.TONAL,this.disableAriaExpanded=!1,this.focusBackToTrigger=!0,this.focusTrap=!0,this.hideOnEscape=!0,this.hideOnOutsideClick=!0,this.interactive=!0,this.showArrow=!1,this.closeButton=!1,this.closeButtonAriaLabel=null}async isOpenUpdated(e,t){return e===t||!this.triggerElement?Promise.resolve():(t&&(this.backdrop=![f,A].includes(this.triggerElement.tagName.toLowerCase())),t===!1&&this.menuItemsWithSubMenus.forEach(i=>{const s=this.getSubMenuPopoverOfTarget(i);s&&s.hide()}),this.resetMenuNavigation(),super.isOpenUpdated(e,t))}async firstUpdated(e){await super.firstUpdated(e),this.collectMenuItems(),this.resetTabIndexes(0)}resetTabIndexes(e){this.menuItems.length>0&&(this.menuItems.forEach(t=>t.setAttribute("tabindex","-1")),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}getCurrentIndex(e){return this.menuItems.findIndex(t=>t===e)}resetTabIndexAndSetFocus(e,t){e!==t&&(this.menuItems[t].setAttribute("tabindex","-1"),this.menuItems[e].setAttribute("tabindex","0"),this.menuItems[e].focus())}closeAllMenuPopovers(e){this.depthManager.popUntil(t=>t!==e&&p(t))}closeOtherSubMenusOnSameLevel(e){const t=this.menuItemsWithSubMenus.filter(s=>s!==e);this.getOpenSubMenusOfItems(t).forEach(s=>{s.hide()})}fireMenuItemAction(e){e.matches(f)&&e.dispatchEvent(new Event("action",{bubbles:!0,composed:!0}))}handleMouseClick(e){const t=e.target;if(!(!h(t)||!e.isTrusted||t.hasAttribute("soft-disabled"))){if(this.getSubMenuPopoverOfTarget(t)){this.closeOtherSubMenusOnSameLevel(t);return}this.closeAllMenuPopovers(),this.fireMenuItemAction(t)}}};l.styles=[...b.styles,...S];let d=l;C([I({type:String,reflect:!0})],d.prototype,"placement");d.register(c);
